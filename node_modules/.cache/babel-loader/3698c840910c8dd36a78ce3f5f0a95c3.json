{"ast":null,"code":"function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n\n  _setPrototypeOf(subClass, superClass);\n}\n\nfunction _wrapNativeSuper(Class) {\n  var _cache = typeof Map === \"function\" ? new Map() : undefined;\n\n  _wrapNativeSuper = function _wrapNativeSuper(Class) {\n    if (Class === null || !_isNativeFunction(Class)) return Class;\n\n    if (typeof Class !== \"function\") {\n      throw new TypeError(\"Super expression must either be null or a function\");\n    }\n\n    if (typeof _cache !== \"undefined\") {\n      if (_cache.has(Class)) return _cache.get(Class);\n\n      _cache.set(Class, Wrapper);\n    }\n\n    function Wrapper() {\n      return _construct(Class, arguments, _getPrototypeOf(this).constructor);\n    }\n\n    Wrapper.prototype = Object.create(Class.prototype, {\n      constructor: {\n        value: Wrapper,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    return _setPrototypeOf(Wrapper, Class);\n  };\n\n  return _wrapNativeSuper(Class);\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct;\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _isNativeFunction(fn) {\n  return Function.toString.call(fn).indexOf(\"[native code]\") !== -1;\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nvar Translator = require('@uppy/utils/lib/Translator');\n\nvar ee = require('namespace-emitter');\n\nvar cuid = require('cuid');\n\nvar throttle = require('lodash.throttle');\n\nvar prettierBytes = require('@transloadit/prettier-bytes');\n\nvar match = require('mime-match');\n\nvar DefaultStore = require('@uppy/store-default');\n\nvar getFileType = require('@uppy/utils/lib/getFileType');\n\nvar getFileNameAndExtension = require('@uppy/utils/lib/getFileNameAndExtension');\n\nvar generateFileID = require('@uppy/utils/lib/generateFileID');\n\nvar findIndex = require('@uppy/utils/lib/findIndex');\n\nvar supportsUploadProgress = require('./supportsUploadProgress');\n\nvar _require = require('./loggers'),\n    justErrorsLogger = _require.justErrorsLogger,\n    debugLogger = _require.debugLogger;\n\nvar Plugin = require('./Plugin'); // Exported from here.\n\n\nvar RestrictionError = /*#__PURE__*/function (_Error) {\n  _inheritsLoose(RestrictionError, _Error);\n\n  function RestrictionError() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _Error.call.apply(_Error, [this].concat(args)) || this;\n    _this.isRestriction = true;\n    return _this;\n  }\n\n  return RestrictionError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n/**\n * Uppy Core module.\n * Manages plugins, state updates, acts as an event bus,\n * adds/removes files and metadata.\n */\n\n\nvar Uppy = /*#__PURE__*/function () {\n  /**\n   * Instantiate Uppy\n   *\n   * @param {object} opts — Uppy options\n   */\n  function Uppy(opts) {\n    var _this2 = this;\n\n    this.defaultLocale = {\n      strings: {\n        addBulkFilesFailed: {\n          0: 'Failed to add %{smart_count} file due to an internal error',\n          1: 'Failed to add %{smart_count} files due to internal errors'\n        },\n        youCanOnlyUploadX: {\n          0: 'You can only upload %{smart_count} file',\n          1: 'You can only upload %{smart_count} files'\n        },\n        youHaveToAtLeastSelectX: {\n          0: 'You have to select at least %{smart_count} file',\n          1: 'You have to select at least %{smart_count} files'\n        },\n        // The default `exceedsSize2` string only combines the `exceedsSize` string (%{backwardsCompat}) with the size.\n        // Locales can override `exceedsSize2` to specify a different word order. This is for backwards compat with\n        // Uppy 1.9.x and below which did a naive concatenation of `exceedsSize2 + size` instead of using a locale-specific\n        // substitution.\n        // TODO: In 2.0 `exceedsSize2` should be removed in and `exceedsSize` updated to use substitution.\n        exceedsSize2: '%{backwardsCompat} %{size}',\n        exceedsSize: 'This file exceeds maximum allowed size of',\n        inferiorSize: 'This file is smaller than the allowed size of %{size}',\n        youCanOnlyUploadFileTypes: 'You can only upload: %{types}',\n        noNewAlreadyUploading: 'Cannot add new files: already uploading',\n        noDuplicates: 'Cannot add the duplicate file \\'%{fileName}\\', it already exists',\n        companionError: 'Connection with Companion failed',\n        companionUnauthorizeHint: 'To unauthorize to your %{provider} account, please go to %{url}',\n        failedToUpload: 'Failed to upload %{file}',\n        noInternetConnection: 'No Internet connection',\n        connectedToInternet: 'Connected to the Internet',\n        // Strings for remote providers\n        noFilesFound: 'You have no files or folders here',\n        selectX: {\n          0: 'Select %{smart_count}',\n          1: 'Select %{smart_count}'\n        },\n        selectAllFilesFromFolderNamed: 'Select all files from folder %{name}',\n        unselectAllFilesFromFolderNamed: 'Unselect all files from folder %{name}',\n        selectFileNamed: 'Select file %{name}',\n        unselectFileNamed: 'Unselect file %{name}',\n        openFolderNamed: 'Open folder %{name}',\n        cancel: 'Cancel',\n        logOut: 'Log out',\n        filter: 'Filter',\n        resetFilter: 'Reset filter',\n        loading: 'Loading...',\n        authenticateWithTitle: 'Please authenticate with %{pluginName} to select files',\n        authenticateWith: 'Connect to %{pluginName}',\n        searchImages: 'Search for images',\n        enterTextToSearch: 'Enter text to search for images',\n        backToSearch: 'Back to Search',\n        emptyFolderAdded: 'No files were added from empty folder',\n        folderAdded: {\n          0: 'Added %{smart_count} file from %{folder}',\n          1: 'Added %{smart_count} files from %{folder}'\n        }\n      }\n    };\n    var defaultOptions = {\n      id: 'uppy',\n      autoProceed: false,\n      allowMultipleUploads: true,\n      debug: false,\n      restrictions: {\n        maxFileSize: null,\n        minFileSize: null,\n        maxTotalFileSize: null,\n        maxNumberOfFiles: null,\n        minNumberOfFiles: null,\n        allowedFileTypes: null\n      },\n      meta: {},\n      onBeforeFileAdded: function onBeforeFileAdded(currentFile, files) {\n        return currentFile;\n      },\n      onBeforeUpload: function onBeforeUpload(files) {\n        return files;\n      },\n      store: DefaultStore(),\n      logger: justErrorsLogger,\n      infoTimeout: 5000\n    }; // Merge default options with the ones set by user,\n    // making sure to merge restrictions too\n\n    this.opts = _extends({}, defaultOptions, opts, {\n      restrictions: _extends({}, defaultOptions.restrictions, opts && opts.restrictions)\n    }); // Support debug: true for backwards-compatability, unless logger is set in opts\n    // opts instead of this.opts to avoid comparing objects — we set logger: justErrorsLogger in defaultOptions\n\n    if (opts && opts.logger && opts.debug) {\n      this.log('You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.', 'warning');\n    } else if (opts && opts.debug) {\n      this.opts.logger = debugLogger;\n    }\n\n    this.log(\"Using Core v\" + this.constructor.VERSION);\n\n    if (this.opts.restrictions.allowedFileTypes && this.opts.restrictions.allowedFileTypes !== null && !Array.isArray(this.opts.restrictions.allowedFileTypes)) {\n      throw new TypeError('`restrictions.allowedFileTypes` must be an array');\n    }\n\n    this.i18nInit(); // Container for different types of plugins\n\n    this.plugins = {};\n    this.getState = this.getState.bind(this);\n    this.getPlugin = this.getPlugin.bind(this);\n    this.setFileMeta = this.setFileMeta.bind(this);\n    this.setFileState = this.setFileState.bind(this);\n    this.log = this.log.bind(this);\n    this.info = this.info.bind(this);\n    this.hideInfo = this.hideInfo.bind(this);\n    this.addFile = this.addFile.bind(this);\n    this.removeFile = this.removeFile.bind(this);\n    this.pauseResume = this.pauseResume.bind(this);\n    this.validateRestrictions = this.validateRestrictions.bind(this); // ___Why throttle at 500ms?\n    //    - We must throttle at >250ms for superfocus in Dashboard to work well (because animation takes 0.25s, and we want to wait for all animations to be over before refocusing).\n    //    [Practical Check]: if thottle is at 100ms, then if you are uploading a file, and click 'ADD MORE FILES', - focus won't activate in Firefox.\n    //    - We must throttle at around >500ms to avoid performance lags.\n    //    [Practical Check] Firefox, try to upload a big file for a prolonged period of time. Laptop will start to heat up.\n\n    this._calculateProgress = throttle(this._calculateProgress.bind(this), 500, {\n      leading: true,\n      trailing: true\n    });\n    this.updateOnlineStatus = this.updateOnlineStatus.bind(this);\n    this.resetProgress = this.resetProgress.bind(this);\n    this.pauseAll = this.pauseAll.bind(this);\n    this.resumeAll = this.resumeAll.bind(this);\n    this.retryAll = this.retryAll.bind(this);\n    this.cancelAll = this.cancelAll.bind(this);\n    this.retryUpload = this.retryUpload.bind(this);\n    this.upload = this.upload.bind(this);\n    this.emitter = ee();\n    this.on = this.on.bind(this);\n    this.off = this.off.bind(this);\n    this.once = this.emitter.once.bind(this.emitter);\n    this.emit = this.emitter.emit.bind(this.emitter);\n    this.preProcessors = [];\n    this.uploaders = [];\n    this.postProcessors = [];\n    this.store = this.opts.store;\n    this.setState({\n      plugins: {},\n      files: {},\n      currentUploads: {},\n      allowNewUpload: true,\n      capabilities: {\n        uploadProgress: supportsUploadProgress(),\n        individualCancellation: true,\n        resumableUploads: false\n      },\n      totalProgress: 0,\n      meta: _extends({}, this.opts.meta),\n      info: {\n        isHidden: true,\n        type: 'info',\n        message: ''\n      }\n    });\n    this._storeUnsubscribe = this.store.subscribe(function (prevState, nextState, patch) {\n      _this2.emit('state-update', prevState, nextState, patch);\n\n      _this2.updateAll(nextState);\n    }); // Exposing uppy object on window for debugging and testing\n\n    if (this.opts.debug && typeof window !== 'undefined') {\n      window[this.opts.id] = this;\n    }\n\n    this._addListeners(); // Re-enable if we’ll need some capabilities on boot, like isMobileDevice\n    // this._setCapabilities()\n\n  } // _setCapabilities = () => {\n  //   const capabilities = {\n  //     isMobileDevice: isMobileDevice()\n  //   }\n  //   this.setState({\n  //     ...this.getState().capabilities,\n  //     capabilities\n  //   })\n  // }\n\n\n  var _proto = Uppy.prototype;\n\n  _proto.on = function on(event, callback) {\n    this.emitter.on(event, callback);\n    return this;\n  };\n\n  _proto.off = function off(event, callback) {\n    this.emitter.off(event, callback);\n    return this;\n  }\n  /**\n   * Iterate on all plugins and run `update` on them.\n   * Called each time state changes.\n   *\n   */\n  ;\n\n  _proto.updateAll = function updateAll(state) {\n    this.iteratePlugins(function (plugin) {\n      plugin.update(state);\n    });\n  }\n  /**\n   * Updates state with a patch\n   *\n   * @param {object} patch {foo: 'bar'}\n   */\n  ;\n\n  _proto.setState = function setState(patch) {\n    this.store.setState(patch);\n  }\n  /**\n   * Returns current state.\n   *\n   * @returns {object}\n   */\n  ;\n\n  _proto.getState = function getState() {\n    return this.store.getState();\n  }\n  /**\n   * Back compat for when uppy.state is used instead of uppy.getState().\n   */\n  ;\n  /**\n   * Shorthand to set state for a specific file.\n   */\n\n\n  _proto.setFileState = function setFileState(fileID, state) {\n    var _extends2;\n\n    if (!this.getState().files[fileID]) {\n      throw new Error(\"Can\\u2019t set state for \" + fileID + \" (the file could have been removed)\");\n    }\n\n    this.setState({\n      files: _extends({}, this.getState().files, (_extends2 = {}, _extends2[fileID] = _extends({}, this.getState().files[fileID], state), _extends2))\n    });\n  };\n\n  _proto.i18nInit = function i18nInit() {\n    this.translator = new Translator([this.defaultLocale, this.opts.locale]);\n    this.locale = this.translator.locale;\n    this.i18n = this.translator.translate.bind(this.translator);\n    this.i18nArray = this.translator.translateArray.bind(this.translator);\n  };\n\n  _proto.setOptions = function setOptions(newOpts) {\n    this.opts = _extends({}, this.opts, newOpts, {\n      restrictions: _extends({}, this.opts.restrictions, newOpts && newOpts.restrictions)\n    });\n\n    if (newOpts.meta) {\n      this.setMeta(newOpts.meta);\n    }\n\n    this.i18nInit();\n\n    if (newOpts.locale) {\n      this.iteratePlugins(function (plugin) {\n        plugin.setOptions();\n      });\n    }\n\n    this.setState(); // so that UI re-renders with new options\n  };\n\n  _proto.resetProgress = function resetProgress() {\n    var defaultProgress = {\n      percentage: 0,\n      bytesUploaded: 0,\n      uploadComplete: false,\n      uploadStarted: null\n    };\n\n    var files = _extends({}, this.getState().files);\n\n    var updatedFiles = {};\n    Object.keys(files).forEach(function (fileID) {\n      var updatedFile = _extends({}, files[fileID]);\n\n      updatedFile.progress = _extends({}, updatedFile.progress, defaultProgress);\n      updatedFiles[fileID] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles,\n      totalProgress: 0\n    });\n    this.emit('reset-progress');\n  };\n\n  _proto.addPreProcessor = function addPreProcessor(fn) {\n    this.preProcessors.push(fn);\n  };\n\n  _proto.removePreProcessor = function removePreProcessor(fn) {\n    var i = this.preProcessors.indexOf(fn);\n\n    if (i !== -1) {\n      this.preProcessors.splice(i, 1);\n    }\n  };\n\n  _proto.addPostProcessor = function addPostProcessor(fn) {\n    this.postProcessors.push(fn);\n  };\n\n  _proto.removePostProcessor = function removePostProcessor(fn) {\n    var i = this.postProcessors.indexOf(fn);\n\n    if (i !== -1) {\n      this.postProcessors.splice(i, 1);\n    }\n  };\n\n  _proto.addUploader = function addUploader(fn) {\n    this.uploaders.push(fn);\n  };\n\n  _proto.removeUploader = function removeUploader(fn) {\n    var i = this.uploaders.indexOf(fn);\n\n    if (i !== -1) {\n      this.uploaders.splice(i, 1);\n    }\n  };\n\n  _proto.setMeta = function setMeta(data) {\n    var updatedMeta = _extends({}, this.getState().meta, data);\n\n    var updatedFiles = _extends({}, this.getState().files);\n\n    Object.keys(updatedFiles).forEach(function (fileID) {\n      updatedFiles[fileID] = _extends({}, updatedFiles[fileID], {\n        meta: _extends({}, updatedFiles[fileID].meta, data)\n      });\n    });\n    this.log('Adding metadata:');\n    this.log(data);\n    this.setState({\n      meta: updatedMeta,\n      files: updatedFiles\n    });\n  };\n\n  _proto.setFileMeta = function setFileMeta(fileID, data) {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    if (!updatedFiles[fileID]) {\n      this.log('Was trying to set metadata for a file that has been removed: ', fileID);\n      return;\n    }\n\n    var newMeta = _extends({}, updatedFiles[fileID].meta, data);\n\n    updatedFiles[fileID] = _extends({}, updatedFiles[fileID], {\n      meta: newMeta\n    });\n    this.setState({\n      files: updatedFiles\n    });\n  }\n  /**\n   * Get a file object.\n   *\n   * @param {string} fileID The ID of the file object to return.\n   */\n  ;\n\n  _proto.getFile = function getFile(fileID) {\n    return this.getState().files[fileID];\n  }\n  /**\n   * Get all files in an array.\n   */\n  ;\n\n  _proto.getFiles = function getFiles() {\n    var _this$getState = this.getState(),\n        files = _this$getState.files;\n\n    return Object.keys(files).map(function (fileID) {\n      return files[fileID];\n    });\n  }\n  /**\n   * A public wrapper for _checkRestrictions — checks if a file passes a set of restrictions.\n   * For use in UI pluigins (like Providers), to disallow selecting files that won’t pass restrictions.\n   *\n   * @param {object} file object to check\n   * @param {Array} [files] array to check maxNumberOfFiles and maxTotalFileSize\n   * @returns {object} { result: true/false, reason: why file didn’t pass restrictions }\n   */\n  ;\n\n  _proto.validateRestrictions = function validateRestrictions(file, files) {\n    try {\n      this._checkRestrictions(file, files);\n\n      return {\n        result: true\n      };\n    } catch (err) {\n      return {\n        result: false,\n        reason: err.message\n      };\n    }\n  }\n  /**\n   * Check if file passes a set of restrictions set in options: maxFileSize, minFileSize,\n   * maxNumberOfFiles and allowedFileTypes.\n   *\n   * @param {object} file object to check\n   * @param {Array} [files] array to check maxNumberOfFiles and maxTotalFileSize\n   * @private\n   */\n  ;\n\n  _proto._checkRestrictions = function _checkRestrictions(file, files) {\n    if (files === void 0) {\n      files = this.getFiles();\n    }\n\n    var _this$opts$restrictio = this.opts.restrictions,\n        maxFileSize = _this$opts$restrictio.maxFileSize,\n        minFileSize = _this$opts$restrictio.minFileSize,\n        maxTotalFileSize = _this$opts$restrictio.maxTotalFileSize,\n        maxNumberOfFiles = _this$opts$restrictio.maxNumberOfFiles,\n        allowedFileTypes = _this$opts$restrictio.allowedFileTypes;\n\n    if (maxNumberOfFiles) {\n      if (files.length + 1 > maxNumberOfFiles) {\n        throw new RestrictionError(\"\" + this.i18n('youCanOnlyUploadX', {\n          smart_count: maxNumberOfFiles\n        }));\n      }\n    }\n\n    if (allowedFileTypes) {\n      var isCorrectFileType = allowedFileTypes.some(function (type) {\n        // check if this is a mime-type\n        if (type.indexOf('/') > -1) {\n          if (!file.type) return false;\n          return match(file.type.replace(/;.*?$/, ''), type);\n        } // otherwise this is likely an extension\n\n\n        if (type[0] === '.' && file.extension) {\n          return file.extension.toLowerCase() === type.substr(1).toLowerCase();\n        }\n\n        return false;\n      });\n\n      if (!isCorrectFileType) {\n        var allowedFileTypesString = allowedFileTypes.join(', ');\n        throw new RestrictionError(this.i18n('youCanOnlyUploadFileTypes', {\n          types: allowedFileTypesString\n        }));\n      }\n    } // We can't check maxTotalFileSize if the size is unknown.\n\n\n    if (maxTotalFileSize && file.size != null) {\n      var totalFilesSize = 0;\n      totalFilesSize += file.size;\n      files.forEach(function (file) {\n        totalFilesSize += file.size;\n      });\n\n      if (totalFilesSize > maxTotalFileSize) {\n        throw new RestrictionError(this.i18n('exceedsSize2', {\n          backwardsCompat: this.i18n('exceedsSize'),\n          size: prettierBytes(maxTotalFileSize)\n        }));\n      }\n    } // We can't check maxFileSize if the size is unknown.\n\n\n    if (maxFileSize && file.size != null) {\n      if (file.size > maxFileSize) {\n        throw new RestrictionError(this.i18n('exceedsSize2', {\n          backwardsCompat: this.i18n('exceedsSize'),\n          size: prettierBytes(maxFileSize)\n        }));\n      }\n    } // We can't check minFileSize if the size is unknown.\n\n\n    if (minFileSize && file.size != null) {\n      if (file.size < minFileSize) {\n        throw new RestrictionError(this.i18n('inferiorSize', {\n          size: prettierBytes(minFileSize)\n        }));\n      }\n    }\n  }\n  /**\n   * Check if minNumberOfFiles restriction is reached before uploading.\n   *\n   * @private\n   */\n  ;\n\n  _proto._checkMinNumberOfFiles = function _checkMinNumberOfFiles(files) {\n    var minNumberOfFiles = this.opts.restrictions.minNumberOfFiles;\n\n    if (Object.keys(files).length < minNumberOfFiles) {\n      throw new RestrictionError(\"\" + this.i18n('youHaveToAtLeastSelectX', {\n        smart_count: minNumberOfFiles\n      }));\n    }\n  }\n  /**\n   * Logs an error, sets Informer message, then throws the error.\n   * Emits a 'restriction-failed' event if it’s a restriction error\n   *\n   * @param {object | string} err — Error object or plain string message\n   * @param {object} [options]\n   * @param {boolean} [options.showInformer=true] — Sometimes developer might want to show Informer manually\n   * @param {object} [options.file=null] — File object used to emit the restriction error\n   * @param {boolean} [options.throwErr=true] — Errors shouldn’t be thrown, for example, in `upload-error` event\n   * @private\n   */\n  ;\n\n  _proto._showOrLogErrorAndThrow = function _showOrLogErrorAndThrow(err, _temp) {\n    var _ref = _temp === void 0 ? {} : _temp,\n        _ref$showInformer = _ref.showInformer,\n        showInformer = _ref$showInformer === void 0 ? true : _ref$showInformer,\n        _ref$file = _ref.file,\n        file = _ref$file === void 0 ? null : _ref$file,\n        _ref$throwErr = _ref.throwErr,\n        throwErr = _ref$throwErr === void 0 ? true : _ref$throwErr;\n\n    var message = typeof err === 'object' ? err.message : err;\n    var details = typeof err === 'object' && err.details ? err.details : ''; // Restriction errors should be logged, but not as errors,\n    // as they are expected and shown in the UI.\n\n    var logMessageWithDetails = message;\n\n    if (details) {\n      logMessageWithDetails += \" \" + details;\n    }\n\n    if (err.isRestriction) {\n      this.log(logMessageWithDetails);\n      this.emit('restriction-failed', file, err);\n    } else {\n      this.log(logMessageWithDetails, 'error');\n    } // Sometimes informer has to be shown manually by the developer,\n    // for example, in `onBeforeFileAdded`.\n\n\n    if (showInformer) {\n      this.info({\n        message: message,\n        details: details\n      }, 'error', this.opts.infoTimeout);\n    }\n\n    if (throwErr) {\n      throw typeof err === 'object' ? err : new Error(err);\n    }\n  };\n\n  _proto._assertNewUploadAllowed = function _assertNewUploadAllowed(file) {\n    var _this$getState2 = this.getState(),\n        allowNewUpload = _this$getState2.allowNewUpload;\n\n    if (allowNewUpload === false) {\n      this._showOrLogErrorAndThrow(new RestrictionError(this.i18n('noNewAlreadyUploading')), {\n        file: file\n      });\n    }\n  }\n  /**\n   * Create a file state object based on user-provided `addFile()` options.\n   *\n   * Note this is extremely side-effectful and should only be done when a file state object will be added to state immediately afterward!\n   *\n   * The `files` value is passed in because it may be updated by the caller without updating the store.\n   */\n  ;\n\n  _proto._checkAndCreateFileStateObject = function _checkAndCreateFileStateObject(files, file) {\n    var fileType = getFileType(file);\n    file.type = fileType;\n    var onBeforeFileAddedResult = this.opts.onBeforeFileAdded(file, files);\n\n    if (onBeforeFileAddedResult === false) {\n      // Don’t show UI info for this error, as it should be done by the developer\n      this._showOrLogErrorAndThrow(new RestrictionError('Cannot add the file because onBeforeFileAdded returned false.'), {\n        showInformer: false,\n        file: file\n      });\n    }\n\n    if (typeof onBeforeFileAddedResult === 'object' && onBeforeFileAddedResult) {\n      file = onBeforeFileAddedResult;\n    }\n\n    var fileName;\n\n    if (file.name) {\n      fileName = file.name;\n    } else if (fileType.split('/')[0] === 'image') {\n      fileName = fileType.split('/')[0] + \".\" + fileType.split('/')[1];\n    } else {\n      fileName = 'noname';\n    }\n\n    var fileExtension = getFileNameAndExtension(fileName).extension;\n    var isRemote = file.isRemote || false;\n    var fileID = generateFileID(file);\n\n    if (files[fileID]) {\n      this._showOrLogErrorAndThrow(new RestrictionError(this.i18n('noDuplicates', {\n        fileName: fileName\n      })), {\n        file: file\n      });\n    }\n\n    var meta = file.meta || {};\n    meta.name = fileName;\n    meta.type = fileType; // `null` means the size is unknown.\n\n    var size = isFinite(file.data.size) ? file.data.size : null;\n    var newFile = {\n      source: file.source || '',\n      id: fileID,\n      name: fileName,\n      extension: fileExtension || '',\n      meta: _extends({}, this.getState().meta, meta),\n      type: fileType,\n      data: file.data,\n      progress: {\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: size,\n        uploadComplete: false,\n        uploadStarted: null\n      },\n      size: size,\n      isRemote: isRemote,\n      remote: file.remote || '',\n      preview: file.preview\n    };\n\n    try {\n      var filesArray = Object.keys(files).map(function (i) {\n        return files[i];\n      });\n\n      this._checkRestrictions(newFile, filesArray);\n    } catch (err) {\n      this._showOrLogErrorAndThrow(err, {\n        file: newFile\n      });\n    }\n\n    return newFile;\n  } // Schedule an upload if `autoProceed` is enabled.\n  ;\n\n  _proto._startIfAutoProceed = function _startIfAutoProceed() {\n    var _this3 = this;\n\n    if (this.opts.autoProceed && !this.scheduledAutoProceed) {\n      this.scheduledAutoProceed = setTimeout(function () {\n        _this3.scheduledAutoProceed = null;\n\n        _this3.upload().catch(function (err) {\n          if (!err.isRestriction) {\n            _this3.log(err.stack || err.message || err);\n          }\n        });\n      }, 4);\n    }\n  }\n  /**\n   * Add a new file to `state.files`. This will run `onBeforeFileAdded`,\n   * try to guess file type in a clever way, check file against restrictions,\n   * and start an upload if `autoProceed === true`.\n   *\n   * @param {object} file object to add\n   * @returns {string} id for the added file\n   */\n  ;\n\n  _proto.addFile = function addFile(file) {\n    var _extends3;\n\n    this._assertNewUploadAllowed(file);\n\n    var _this$getState3 = this.getState(),\n        files = _this$getState3.files;\n\n    var newFile = this._checkAndCreateFileStateObject(files, file);\n\n    this.setState({\n      files: _extends({}, files, (_extends3 = {}, _extends3[newFile.id] = newFile, _extends3))\n    });\n    this.emit('file-added', newFile);\n    this.emit('files-added', [newFile]);\n    this.log(\"Added file: \" + newFile.name + \", \" + newFile.id + \", mime type: \" + newFile.type);\n\n    this._startIfAutoProceed();\n\n    return newFile.id;\n  }\n  /**\n   * Add multiple files to `state.files`. See the `addFile()` documentation.\n   *\n   * This cuts some corners for performance, so should typically only be used in cases where there may be a lot of files.\n   *\n   * If an error occurs while adding a file, it is logged and the user is notified. This is good for UI plugins, but not for programmatic use. Programmatic users should usually still use `addFile()` on individual files.\n   */\n  ;\n\n  _proto.addFiles = function addFiles(fileDescriptors) {\n    var _this4 = this;\n\n    this._assertNewUploadAllowed(); // create a copy of the files object only once\n\n\n    var files = _extends({}, this.getState().files);\n\n    var newFiles = [];\n    var errors = [];\n\n    for (var i = 0; i < fileDescriptors.length; i++) {\n      try {\n        var newFile = this._checkAndCreateFileStateObject(files, fileDescriptors[i]);\n\n        newFiles.push(newFile);\n        files[newFile.id] = newFile;\n      } catch (err) {\n        if (!err.isRestriction) {\n          errors.push(err);\n        }\n      }\n    }\n\n    this.setState({\n      files: files\n    });\n    newFiles.forEach(function (newFile) {\n      _this4.emit('file-added', newFile);\n    });\n    this.emit('files-added', newFiles);\n\n    if (newFiles.length > 5) {\n      this.log(\"Added batch of \" + newFiles.length + \" files\");\n    } else {\n      Object.keys(newFiles).forEach(function (fileID) {\n        _this4.log(\"Added file: \" + newFiles[fileID].name + \"\\n id: \" + newFiles[fileID].id + \"\\n type: \" + newFiles[fileID].type);\n      });\n    }\n\n    if (newFiles.length > 0) {\n      this._startIfAutoProceed();\n    }\n\n    if (errors.length > 0) {\n      var message = 'Multiple errors occurred while adding files:\\n';\n      errors.forEach(function (subError) {\n        message += \"\\n * \" + subError.message;\n      });\n      this.info({\n        message: this.i18n('addBulkFilesFailed', {\n          smart_count: errors.length\n        }),\n        details: message\n      }, 'error', this.opts.infoTimeout);\n      var err = new Error(message);\n      err.errors = errors;\n      throw err;\n    }\n  };\n\n  _proto.removeFiles = function removeFiles(fileIDs, reason) {\n    var _this5 = this;\n\n    var _this$getState4 = this.getState(),\n        files = _this$getState4.files,\n        currentUploads = _this$getState4.currentUploads;\n\n    var updatedFiles = _extends({}, files);\n\n    var updatedUploads = _extends({}, currentUploads);\n\n    var removedFiles = Object.create(null);\n    fileIDs.forEach(function (fileID) {\n      if (files[fileID]) {\n        removedFiles[fileID] = files[fileID];\n        delete updatedFiles[fileID];\n      }\n    }); // Remove files from the `fileIDs` list in each upload.\n\n    function fileIsNotRemoved(uploadFileID) {\n      return removedFiles[uploadFileID] === undefined;\n    }\n\n    var uploadsToRemove = [];\n    Object.keys(updatedUploads).forEach(function (uploadID) {\n      var newFileIDs = currentUploads[uploadID].fileIDs.filter(fileIsNotRemoved); // Remove the upload if no files are associated with it anymore.\n\n      if (newFileIDs.length === 0) {\n        uploadsToRemove.push(uploadID);\n        return;\n      }\n\n      updatedUploads[uploadID] = _extends({}, currentUploads[uploadID], {\n        fileIDs: newFileIDs\n      });\n    });\n    uploadsToRemove.forEach(function (uploadID) {\n      delete updatedUploads[uploadID];\n    });\n    var stateUpdate = {\n      currentUploads: updatedUploads,\n      files: updatedFiles\n    }; // If all files were removed - allow new uploads!\n\n    if (Object.keys(updatedFiles).length === 0) {\n      stateUpdate.allowNewUpload = true;\n      stateUpdate.error = null;\n    }\n\n    this.setState(stateUpdate);\n\n    this._calculateTotalProgress();\n\n    var removedFileIDs = Object.keys(removedFiles);\n    removedFileIDs.forEach(function (fileID) {\n      _this5.emit('file-removed', removedFiles[fileID], reason);\n    });\n\n    if (removedFileIDs.length > 5) {\n      this.log(\"Removed \" + removedFileIDs.length + \" files\");\n    } else {\n      this.log(\"Removed files: \" + removedFileIDs.join(', '));\n    }\n  };\n\n  _proto.removeFile = function removeFile(fileID, reason) {\n    if (reason === void 0) {\n      reason = null;\n    }\n\n    this.removeFiles([fileID], reason);\n  };\n\n  _proto.pauseResume = function pauseResume(fileID) {\n    if (!this.getState().capabilities.resumableUploads || this.getFile(fileID).uploadComplete) {\n      return;\n    }\n\n    var wasPaused = this.getFile(fileID).isPaused || false;\n    var isPaused = !wasPaused;\n    this.setFileState(fileID, {\n      isPaused: isPaused\n    });\n    this.emit('upload-pause', fileID, isPaused);\n    return isPaused;\n  };\n\n  _proto.pauseAll = function pauseAll() {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    var inProgressUpdatedFiles = Object.keys(updatedFiles).filter(function (file) {\n      return !updatedFiles[file].progress.uploadComplete && updatedFiles[file].progress.uploadStarted;\n    });\n    inProgressUpdatedFiles.forEach(function (file) {\n      var updatedFile = _extends({}, updatedFiles[file], {\n        isPaused: true\n      });\n\n      updatedFiles[file] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles\n    });\n    this.emit('pause-all');\n  };\n\n  _proto.resumeAll = function resumeAll() {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    var inProgressUpdatedFiles = Object.keys(updatedFiles).filter(function (file) {\n      return !updatedFiles[file].progress.uploadComplete && updatedFiles[file].progress.uploadStarted;\n    });\n    inProgressUpdatedFiles.forEach(function (file) {\n      var updatedFile = _extends({}, updatedFiles[file], {\n        isPaused: false,\n        error: null\n      });\n\n      updatedFiles[file] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles\n    });\n    this.emit('resume-all');\n  };\n\n  _proto.retryAll = function retryAll() {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    var filesToRetry = Object.keys(updatedFiles).filter(function (file) {\n      return updatedFiles[file].error;\n    });\n    filesToRetry.forEach(function (file) {\n      var updatedFile = _extends({}, updatedFiles[file], {\n        isPaused: false,\n        error: null\n      });\n\n      updatedFiles[file] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles,\n      error: null\n    });\n    this.emit('retry-all', filesToRetry);\n\n    if (filesToRetry.length === 0) {\n      return Promise.resolve({\n        successful: [],\n        failed: []\n      });\n    }\n\n    var uploadID = this._createUpload(filesToRetry, {\n      forceAllowNewUpload: true // create new upload even if allowNewUpload: false\n\n    });\n\n    return this._runUpload(uploadID);\n  };\n\n  _proto.cancelAll = function cancelAll() {\n    this.emit('cancel-all');\n\n    var _this$getState5 = this.getState(),\n        files = _this$getState5.files;\n\n    var fileIDs = Object.keys(files);\n\n    if (fileIDs.length) {\n      this.removeFiles(fileIDs, 'cancel-all');\n    }\n\n    this.setState({\n      totalProgress: 0,\n      error: null\n    });\n  };\n\n  _proto.retryUpload = function retryUpload(fileID) {\n    this.setFileState(fileID, {\n      error: null,\n      isPaused: false\n    });\n    this.emit('upload-retry', fileID);\n\n    var uploadID = this._createUpload([fileID], {\n      forceAllowNewUpload: true // create new upload even if allowNewUpload: false\n\n    });\n\n    return this._runUpload(uploadID);\n  };\n\n  _proto.reset = function reset() {\n    this.cancelAll();\n  };\n\n  _proto._calculateProgress = function _calculateProgress(file, data) {\n    if (!this.getFile(file.id)) {\n      this.log(\"Not setting progress for a file that has been removed: \" + file.id);\n      return;\n    } // bytesTotal may be null or zero; in that case we can't divide by it\n\n\n    var canHavePercentage = isFinite(data.bytesTotal) && data.bytesTotal > 0;\n    this.setFileState(file.id, {\n      progress: _extends({}, this.getFile(file.id).progress, {\n        bytesUploaded: data.bytesUploaded,\n        bytesTotal: data.bytesTotal,\n        percentage: canHavePercentage // TODO(goto-bus-stop) flooring this should probably be the choice of the UI?\n        // we get more accurate calculations if we don't round this at all.\n        ? Math.round(data.bytesUploaded / data.bytesTotal * 100) : 0\n      })\n    });\n\n    this._calculateTotalProgress();\n  };\n\n  _proto._calculateTotalProgress = function _calculateTotalProgress() {\n    // calculate total progress, using the number of files currently uploading,\n    // multiplied by 100 and the summ of individual progress of each file\n    var files = this.getFiles();\n    var inProgress = files.filter(function (file) {\n      return file.progress.uploadStarted || file.progress.preprocess || file.progress.postprocess;\n    });\n\n    if (inProgress.length === 0) {\n      this.emit('progress', 0);\n      this.setState({\n        totalProgress: 0\n      });\n      return;\n    }\n\n    var sizedFiles = inProgress.filter(function (file) {\n      return file.progress.bytesTotal != null;\n    });\n    var unsizedFiles = inProgress.filter(function (file) {\n      return file.progress.bytesTotal == null;\n    });\n\n    if (sizedFiles.length === 0) {\n      var progressMax = inProgress.length * 100;\n      var currentProgress = unsizedFiles.reduce(function (acc, file) {\n        return acc + file.progress.percentage;\n      }, 0);\n\n      var _totalProgress = Math.round(currentProgress / progressMax * 100);\n\n      this.setState({\n        totalProgress: _totalProgress\n      });\n      return;\n    }\n\n    var totalSize = sizedFiles.reduce(function (acc, file) {\n      return acc + file.progress.bytesTotal;\n    }, 0);\n    var averageSize = totalSize / sizedFiles.length;\n    totalSize += averageSize * unsizedFiles.length;\n    var uploadedSize = 0;\n    sizedFiles.forEach(function (file) {\n      uploadedSize += file.progress.bytesUploaded;\n    });\n    unsizedFiles.forEach(function (file) {\n      uploadedSize += averageSize * (file.progress.percentage || 0) / 100;\n    });\n    var totalProgress = totalSize === 0 ? 0 : Math.round(uploadedSize / totalSize * 100); // hot fix, because:\n    // uploadedSize ended up larger than totalSize, resulting in 1325% total\n\n    if (totalProgress > 100) {\n      totalProgress = 100;\n    }\n\n    this.setState({\n      totalProgress: totalProgress\n    });\n    this.emit('progress', totalProgress);\n  }\n  /**\n   * Registers listeners for all global actions, like:\n   * `error`, `file-removed`, `upload-progress`\n   */\n  ;\n\n  _proto._addListeners = function _addListeners() {\n    var _this6 = this;\n\n    this.on('error', function (error) {\n      var errorMsg = 'Unknown error';\n\n      if (error.message) {\n        errorMsg = error.message;\n      }\n\n      if (error.details) {\n        errorMsg += \" \" + error.details;\n      }\n\n      _this6.setState({\n        error: errorMsg\n      });\n    });\n    this.on('upload-error', function (file, error, response) {\n      var errorMsg = 'Unknown error';\n\n      if (error.message) {\n        errorMsg = error.message;\n      }\n\n      if (error.details) {\n        errorMsg += \" \" + error.details;\n      }\n\n      _this6.setFileState(file.id, {\n        error: errorMsg,\n        response: response\n      });\n\n      _this6.setState({\n        error: error.message\n      });\n\n      if (typeof error === 'object' && error.message) {\n        var newError = new Error(error.message);\n        newError.details = error.message;\n\n        if (error.details) {\n          newError.details += \" \" + error.details;\n        }\n\n        newError.message = _this6.i18n('failedToUpload', {\n          file: file.name\n        });\n\n        _this6._showOrLogErrorAndThrow(newError, {\n          throwErr: false\n        });\n      } else {\n        _this6._showOrLogErrorAndThrow(error, {\n          throwErr: false\n        });\n      }\n    });\n    this.on('upload', function () {\n      _this6.setState({\n        error: null\n      });\n    });\n    this.on('upload-started', function (file, upload) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      _this6.setFileState(file.id, {\n        progress: {\n          uploadStarted: Date.now(),\n          uploadComplete: false,\n          percentage: 0,\n          bytesUploaded: 0,\n          bytesTotal: file.size\n        }\n      });\n    });\n    this.on('upload-progress', this._calculateProgress);\n    this.on('upload-success', function (file, uploadResp) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      var currentProgress = _this6.getFile(file.id).progress;\n\n      _this6.setFileState(file.id, {\n        progress: _extends({}, currentProgress, {\n          postprocess: _this6.postProcessors.length > 0 ? {\n            mode: 'indeterminate'\n          } : null,\n          uploadComplete: true,\n          percentage: 100,\n          bytesUploaded: currentProgress.bytesTotal\n        }),\n        response: uploadResp,\n        uploadURL: uploadResp.uploadURL,\n        isPaused: false\n      });\n\n      _this6._calculateTotalProgress();\n    });\n    this.on('preprocess-progress', function (file, progress) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      _this6.setFileState(file.id, {\n        progress: _extends({}, _this6.getFile(file.id).progress, {\n          preprocess: progress\n        })\n      });\n    });\n    this.on('preprocess-complete', function (file) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      var files = _extends({}, _this6.getState().files);\n\n      files[file.id] = _extends({}, files[file.id], {\n        progress: _extends({}, files[file.id].progress)\n      });\n      delete files[file.id].progress.preprocess;\n\n      _this6.setState({\n        files: files\n      });\n    });\n    this.on('postprocess-progress', function (file, progress) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      _this6.setFileState(file.id, {\n        progress: _extends({}, _this6.getState().files[file.id].progress, {\n          postprocess: progress\n        })\n      });\n    });\n    this.on('postprocess-complete', function (file) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      var files = _extends({}, _this6.getState().files);\n\n      files[file.id] = _extends({}, files[file.id], {\n        progress: _extends({}, files[file.id].progress)\n      });\n      delete files[file.id].progress.postprocess; // TODO should we set some kind of `fullyComplete` property on the file object\n      // so it's easier to see that the file is upload…fully complete…rather than\n      // what we have to do now (`uploadComplete && !postprocess`)\n\n      _this6.setState({\n        files: files\n      });\n    });\n    this.on('restored', function () {\n      // Files may have changed--ensure progress is still accurate.\n      _this6._calculateTotalProgress();\n    }); // show informer if offline\n\n    if (typeof window !== 'undefined' && window.addEventListener) {\n      window.addEventListener('online', function () {\n        return _this6.updateOnlineStatus();\n      });\n      window.addEventListener('offline', function () {\n        return _this6.updateOnlineStatus();\n      });\n      setTimeout(function () {\n        return _this6.updateOnlineStatus();\n      }, 3000);\n    }\n  };\n\n  _proto.updateOnlineStatus = function updateOnlineStatus() {\n    var online = typeof window.navigator.onLine !== 'undefined' ? window.navigator.onLine : true;\n\n    if (!online) {\n      this.emit('is-offline');\n      this.info(this.i18n('noInternetConnection'), 'error', 0);\n      this.wasOffline = true;\n    } else {\n      this.emit('is-online');\n\n      if (this.wasOffline) {\n        this.emit('back-online');\n        this.info(this.i18n('connectedToInternet'), 'success', 3000);\n        this.wasOffline = false;\n      }\n    }\n  };\n\n  _proto.getID = function getID() {\n    return this.opts.id;\n  }\n  /**\n   * Registers a plugin with Core.\n   *\n   * @param {object} Plugin object\n   * @param {object} [opts] object with options to be passed to Plugin\n   * @returns {object} self for chaining\n   */\n  ;\n\n  _proto.use = function use(Plugin, opts) {\n    if (typeof Plugin !== 'function') {\n      var msg = \"Expected a plugin class, but got \" + (Plugin === null ? 'null' : typeof Plugin) + \".\" + ' Please verify that the plugin was imported and spelled correctly.';\n      throw new TypeError(msg);\n    } // Instantiate\n\n\n    var plugin = new Plugin(this, opts);\n    var pluginId = plugin.id;\n    this.plugins[plugin.type] = this.plugins[plugin.type] || [];\n\n    if (!pluginId) {\n      throw new Error('Your plugin must have an id');\n    }\n\n    if (!plugin.type) {\n      throw new Error('Your plugin must have a type');\n    }\n\n    var existsPluginAlready = this.getPlugin(pluginId);\n\n    if (existsPluginAlready) {\n      var _msg = \"Already found a plugin named '\" + existsPluginAlready.id + \"'. \" + (\"Tried to use: '\" + pluginId + \"'.\\n\") + 'Uppy plugins must have unique `id` options. See https://uppy.io/docs/plugins/#id.';\n\n      throw new Error(_msg);\n    }\n\n    if (Plugin.VERSION) {\n      this.log(\"Using \" + pluginId + \" v\" + Plugin.VERSION);\n    }\n\n    this.plugins[plugin.type].push(plugin);\n    plugin.install();\n    return this;\n  }\n  /**\n   * Find one Plugin by name.\n   *\n   * @param {string} id plugin id\n   * @returns {object|boolean}\n   */\n  ;\n\n  _proto.getPlugin = function getPlugin(id) {\n    var foundPlugin = null;\n    this.iteratePlugins(function (plugin) {\n      if (plugin.id === id) {\n        foundPlugin = plugin;\n        return false;\n      }\n    });\n    return foundPlugin;\n  }\n  /**\n   * Iterate through all `use`d plugins.\n   *\n   * @param {Function} method that will be run on each plugin\n   */\n  ;\n\n  _proto.iteratePlugins = function iteratePlugins(method) {\n    var _this7 = this;\n\n    Object.keys(this.plugins).forEach(function (pluginType) {\n      _this7.plugins[pluginType].forEach(method);\n    });\n  }\n  /**\n   * Uninstall and remove a plugin.\n   *\n   * @param {object} instance The plugin instance to remove.\n   */\n  ;\n\n  _proto.removePlugin = function removePlugin(instance) {\n    var _extends4;\n\n    this.log(\"Removing plugin \" + instance.id);\n    this.emit('plugin-remove', instance);\n\n    if (instance.uninstall) {\n      instance.uninstall();\n    }\n\n    var list = this.plugins[instance.type].slice(); // list.indexOf failed here, because Vue3 converted the plugin instance\n    // to a Proxy object, which failed the strict comparison test:\n    // obj !== objProxy\n\n    var index = findIndex(list, function (item) {\n      return item.id === instance.id;\n    });\n\n    if (index !== -1) {\n      list.splice(index, 1);\n      this.plugins[instance.type] = list;\n    }\n\n    var state = this.getState();\n    var updatedState = {\n      plugins: _extends({}, state.plugins, (_extends4 = {}, _extends4[instance.id] = undefined, _extends4))\n    };\n    this.setState(updatedState);\n  }\n  /**\n   * Uninstall all plugins and close down this Uppy instance.\n   */\n  ;\n\n  _proto.close = function close() {\n    var _this8 = this;\n\n    this.log(\"Closing Uppy instance \" + this.opts.id + \": removing all files and uninstalling plugins\");\n    this.reset();\n\n    this._storeUnsubscribe();\n\n    this.iteratePlugins(function (plugin) {\n      _this8.removePlugin(plugin);\n    });\n  }\n  /**\n   * Set info message in `state.info`, so that UI plugins like `Informer`\n   * can display the message.\n   *\n   * @param {string | object} message Message to be displayed by the informer\n   * @param {string} [type]\n   * @param {number} [duration]\n   */\n  ;\n\n  _proto.info = function info(message, type, duration) {\n    if (type === void 0) {\n      type = 'info';\n    }\n\n    if (duration === void 0) {\n      duration = 3000;\n    }\n\n    var isComplexMessage = typeof message === 'object';\n    this.setState({\n      info: {\n        isHidden: false,\n        type: type,\n        message: isComplexMessage ? message.message : message,\n        details: isComplexMessage ? message.details : null\n      }\n    });\n    this.emit('info-visible');\n    clearTimeout(this.infoTimeoutID);\n\n    if (duration === 0) {\n      this.infoTimeoutID = undefined;\n      return;\n    } // hide the informer after `duration` milliseconds\n\n\n    this.infoTimeoutID = setTimeout(this.hideInfo, duration);\n  };\n\n  _proto.hideInfo = function hideInfo() {\n    var newInfo = _extends({}, this.getState().info, {\n      isHidden: true\n    });\n\n    this.setState({\n      info: newInfo\n    });\n    this.emit('info-hidden');\n  }\n  /**\n   * Passes messages to a function, provided in `opts.logger`.\n   * If `opts.logger: Uppy.debugLogger` or `opts.debug: true`, logs to the browser console.\n   *\n   * @param {string|object} message to log\n   * @param {string} [type] optional `error` or `warning`\n   */\n  ;\n\n  _proto.log = function log(message, type) {\n    var logger = this.opts.logger;\n\n    switch (type) {\n      case 'error':\n        logger.error(message);\n        break;\n\n      case 'warning':\n        logger.warn(message);\n        break;\n\n      default:\n        logger.debug(message);\n        break;\n    }\n  }\n  /**\n   * Obsolete, event listeners are now added in the constructor.\n   */\n  ;\n\n  _proto.run = function run() {\n    this.log('Calling run() is no longer necessary.', 'warning');\n    return this;\n  }\n  /**\n   * Restore an upload by its ID.\n   */\n  ;\n\n  _proto.restore = function restore(uploadID) {\n    this.log(\"Core: attempting to restore upload \\\"\" + uploadID + \"\\\"\");\n\n    if (!this.getState().currentUploads[uploadID]) {\n      this._removeUpload(uploadID);\n\n      return Promise.reject(new Error('Nonexistent upload'));\n    }\n\n    return this._runUpload(uploadID);\n  }\n  /**\n   * Create an upload for a bunch of files.\n   *\n   * @param {Array<string>} fileIDs File IDs to include in this upload.\n   * @returns {string} ID of this upload.\n   */\n  ;\n\n  _proto._createUpload = function _createUpload(fileIDs, opts) {\n    var _extends5;\n\n    if (opts === void 0) {\n      opts = {};\n    }\n\n    var _opts = opts,\n        _opts$forceAllowNewUp = _opts.forceAllowNewUpload,\n        forceAllowNewUpload = _opts$forceAllowNewUp === void 0 ? false : _opts$forceAllowNewUp;\n\n    var _this$getState6 = this.getState(),\n        allowNewUpload = _this$getState6.allowNewUpload,\n        currentUploads = _this$getState6.currentUploads;\n\n    if (!allowNewUpload && !forceAllowNewUpload) {\n      throw new Error('Cannot create a new upload: already uploading.');\n    }\n\n    var uploadID = cuid();\n    this.emit('upload', {\n      id: uploadID,\n      fileIDs: fileIDs\n    });\n    this.setState({\n      allowNewUpload: this.opts.allowMultipleUploads !== false,\n      currentUploads: _extends({}, currentUploads, (_extends5 = {}, _extends5[uploadID] = {\n        fileIDs: fileIDs,\n        step: 0,\n        result: {}\n      }, _extends5))\n    });\n    return uploadID;\n  };\n\n  _proto._getUpload = function _getUpload(uploadID) {\n    var _this$getState7 = this.getState(),\n        currentUploads = _this$getState7.currentUploads;\n\n    return currentUploads[uploadID];\n  }\n  /**\n   * Add data to an upload's result object.\n   *\n   * @param {string} uploadID The ID of the upload.\n   * @param {object} data Data properties to add to the result object.\n   */\n  ;\n\n  _proto.addResultData = function addResultData(uploadID, data) {\n    var _extends6;\n\n    if (!this._getUpload(uploadID)) {\n      this.log(\"Not setting result for an upload that has been removed: \" + uploadID);\n      return;\n    }\n\n    var currentUploads = this.getState().currentUploads;\n\n    var currentUpload = _extends({}, currentUploads[uploadID], {\n      result: _extends({}, currentUploads[uploadID].result, data)\n    });\n\n    this.setState({\n      currentUploads: _extends({}, currentUploads, (_extends6 = {}, _extends6[uploadID] = currentUpload, _extends6))\n    });\n  }\n  /**\n   * Remove an upload, eg. if it has been canceled or completed.\n   *\n   * @param {string} uploadID The ID of the upload.\n   */\n  ;\n\n  _proto._removeUpload = function _removeUpload(uploadID) {\n    var currentUploads = _extends({}, this.getState().currentUploads);\n\n    delete currentUploads[uploadID];\n    this.setState({\n      currentUploads: currentUploads\n    });\n  }\n  /**\n   * Run an upload. This picks up where it left off in case the upload is being restored.\n   *\n   * @private\n   */\n  ;\n\n  _proto._runUpload = function _runUpload(uploadID) {\n    var _this9 = this;\n\n    var uploadData = this.getState().currentUploads[uploadID];\n    var restoreStep = uploadData.step;\n    var steps = [].concat(this.preProcessors, this.uploaders, this.postProcessors);\n    var lastStep = Promise.resolve();\n    steps.forEach(function (fn, step) {\n      // Skip this step if we are restoring and have already completed this step before.\n      if (step < restoreStep) {\n        return;\n      }\n\n      lastStep = lastStep.then(function () {\n        var _extends7;\n\n        var _this9$getState = _this9.getState(),\n            currentUploads = _this9$getState.currentUploads;\n\n        var currentUpload = currentUploads[uploadID];\n\n        if (!currentUpload) {\n          return;\n        }\n\n        var updatedUpload = _extends({}, currentUpload, {\n          step: step\n        });\n\n        _this9.setState({\n          currentUploads: _extends({}, currentUploads, (_extends7 = {}, _extends7[uploadID] = updatedUpload, _extends7))\n        }); // TODO give this the `updatedUpload` object as its only parameter maybe?\n        // Otherwise when more metadata may be added to the upload this would keep getting more parameters\n\n\n        return fn(updatedUpload.fileIDs, uploadID);\n      }).then(function (result) {\n        return null;\n      });\n    }); // Not returning the `catch`ed promise, because we still want to return a rejected\n    // promise from this method if the upload failed.\n\n    lastStep.catch(function (err) {\n      _this9.emit('error', err, uploadID);\n\n      _this9._removeUpload(uploadID);\n    });\n    return lastStep.then(function () {\n      // Set result data.\n      var _this9$getState2 = _this9.getState(),\n          currentUploads = _this9$getState2.currentUploads;\n\n      var currentUpload = currentUploads[uploadID];\n\n      if (!currentUpload) {\n        return;\n      } // Mark postprocessing step as complete if necessary; this addresses a case where we might get\n      // stuck in the postprocessing UI while the upload is fully complete.\n      // If the postprocessing steps do not do any work, they may not emit postprocessing events at\n      // all, and never mark the postprocessing as complete. This is fine on its own but we\n      // introduced code in the @uppy/core upload-success handler to prepare postprocessing progress\n      // state if any postprocessors are registered. That is to avoid a \"flash of completed state\"\n      // before the postprocessing plugins can emit events.\n      //\n      // So, just in case an upload with postprocessing plugins *has* completed *without* emitting\n      // postprocessing completion, we do it instead.\n\n\n      currentUpload.fileIDs.forEach(function (fileID) {\n        var file = _this9.getFile(fileID);\n\n        if (file && file.progress.postprocess) {\n          _this9.emit('postprocess-complete', file);\n        }\n      });\n      var files = currentUpload.fileIDs.map(function (fileID) {\n        return _this9.getFile(fileID);\n      });\n      var successful = files.filter(function (file) {\n        return !file.error;\n      });\n      var failed = files.filter(function (file) {\n        return file.error;\n      });\n\n      _this9.addResultData(uploadID, {\n        successful: successful,\n        failed: failed,\n        uploadID: uploadID\n      });\n    }).then(function () {\n      // Emit completion events.\n      // This is in a separate function so that the `currentUploads` variable\n      // always refers to the latest state. In the handler right above it refers\n      // to an outdated object without the `.result` property.\n      var _this9$getState3 = _this9.getState(),\n          currentUploads = _this9$getState3.currentUploads;\n\n      if (!currentUploads[uploadID]) {\n        return;\n      }\n\n      var currentUpload = currentUploads[uploadID];\n      var result = currentUpload.result;\n\n      _this9.emit('complete', result);\n\n      _this9._removeUpload(uploadID);\n\n      return result;\n    }).then(function (result) {\n      if (result == null) {\n        _this9.log(\"Not setting result for an upload that has been removed: \" + uploadID);\n      }\n\n      return result;\n    });\n  }\n  /**\n   * Start an upload for all the files that are not currently being uploaded.\n   *\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.upload = function upload() {\n    var _this10 = this;\n\n    if (!this.plugins.uploader) {\n      this.log('No uploader type plugins are used', 'warning');\n    }\n\n    var files = this.getState().files;\n    var onBeforeUploadResult = this.opts.onBeforeUpload(files);\n\n    if (onBeforeUploadResult === false) {\n      return Promise.reject(new Error('Not starting the upload because onBeforeUpload returned false'));\n    }\n\n    if (onBeforeUploadResult && typeof onBeforeUploadResult === 'object') {\n      files = onBeforeUploadResult; // Updating files in state, because uploader plugins receive file IDs,\n      // and then fetch the actual file object from state\n\n      this.setState({\n        files: files\n      });\n    }\n\n    return Promise.resolve().then(function () {\n      return _this10._checkMinNumberOfFiles(files);\n    }).catch(function (err) {\n      _this10._showOrLogErrorAndThrow(err);\n    }).then(function () {\n      var _this10$getState = _this10.getState(),\n          currentUploads = _this10$getState.currentUploads; // get a list of files that are currently assigned to uploads\n\n\n      var currentlyUploadingFiles = Object.keys(currentUploads).reduce(function (prev, curr) {\n        return prev.concat(currentUploads[curr].fileIDs);\n      }, []);\n      var waitingFileIDs = [];\n      Object.keys(files).forEach(function (fileID) {\n        var file = _this10.getFile(fileID); // if the file hasn't started uploading and hasn't already been assigned to an upload..\n\n\n        if (!file.progress.uploadStarted && currentlyUploadingFiles.indexOf(fileID) === -1) {\n          waitingFileIDs.push(file.id);\n        }\n      });\n\n      var uploadID = _this10._createUpload(waitingFileIDs);\n\n      return _this10._runUpload(uploadID);\n    }).catch(function (err) {\n      _this10._showOrLogErrorAndThrow(err, {\n        showInformer: false\n      });\n    });\n  };\n\n  _createClass(Uppy, [{\n    key: \"state\",\n    get: function get() {\n      return this.getState();\n    }\n  }]);\n\n  return Uppy;\n}();\n\nUppy.VERSION = \"1.17.0\";\n\nmodule.exports = function (opts) {\n  return new Uppy(opts);\n}; // Expose class constructor.\n\n\nmodule.exports.Uppy = Uppy;\nmodule.exports.Plugin = Plugin;\nmodule.exports.debugLogger = debugLogger;","map":{"version":3,"sources":["/Users/abc/Downloads/Workspace/projectFPT/cms-fusamate/cms-fusamate/cms-fusamte/node_modules/@uppy/core/lib/index.js"],"names":["_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","_defineProperties","props","descriptor","enumerable","configurable","writable","defineProperty","_createClass","Constructor","protoProps","staticProps","_inheritsLoose","subClass","superClass","create","constructor","_setPrototypeOf","_wrapNativeSuper","Class","_cache","Map","undefined","_isNativeFunction","TypeError","has","get","set","Wrapper","_construct","_getPrototypeOf","value","Parent","args","_isNativeReflectConstruct","Reflect","construct","a","push","Function","bind","instance","sham","Proxy","Boolean","valueOf","e","fn","toString","indexOf","o","p","setPrototypeOf","__proto__","getPrototypeOf","Translator","require","ee","cuid","throttle","prettierBytes","match","DefaultStore","getFileType","getFileNameAndExtension","generateFileID","findIndex","supportsUploadProgress","_require","justErrorsLogger","debugLogger","Plugin","RestrictionError","_Error","_this","_len","Array","_key","concat","isRestriction","Error","Uppy","opts","_this2","defaultLocale","strings","addBulkFilesFailed","youCanOnlyUploadX","youHaveToAtLeastSelectX","exceedsSize2","exceedsSize","inferiorSize","youCanOnlyUploadFileTypes","noNewAlreadyUploading","noDuplicates","companionError","companionUnauthorizeHint","failedToUpload","noInternetConnection","connectedToInternet","noFilesFound","selectX","selectAllFilesFromFolderNamed","unselectAllFilesFromFolderNamed","selectFileNamed","unselectFileNamed","openFolderNamed","cancel","logOut","filter","resetFilter","loading","authenticateWithTitle","authenticateWith","searchImages","enterTextToSearch","backToSearch","emptyFolderAdded","folderAdded","defaultOptions","id","autoProceed","allowMultipleUploads","debug","restrictions","maxFileSize","minFileSize","maxTotalFileSize","maxNumberOfFiles","minNumberOfFiles","allowedFileTypes","meta","onBeforeFileAdded","currentFile","files","onBeforeUpload","store","logger","infoTimeout","log","VERSION","isArray","i18nInit","plugins","getState","getPlugin","setFileMeta","setFileState","info","hideInfo","addFile","removeFile","pauseResume","validateRestrictions","_calculateProgress","leading","trailing","updateOnlineStatus","resetProgress","pauseAll","resumeAll","retryAll","cancelAll","retryUpload","upload","emitter","on","off","once","emit","preProcessors","uploaders","postProcessors","setState","currentUploads","allowNewUpload","capabilities","uploadProgress","individualCancellation","resumableUploads","totalProgress","isHidden","type","message","_storeUnsubscribe","subscribe","prevState","nextState","patch","updateAll","window","_addListeners","_proto","event","callback","state","iteratePlugins","plugin","update","fileID","_extends2","translator","locale","i18n","translate","i18nArray","translateArray","setOptions","newOpts","setMeta","defaultProgress","percentage","bytesUploaded","uploadComplete","uploadStarted","updatedFiles","keys","forEach","updatedFile","progress","addPreProcessor","removePreProcessor","splice","addPostProcessor","removePostProcessor","addUploader","removeUploader","data","updatedMeta","newMeta","getFile","getFiles","_this$getState","map","file","_checkRestrictions","result","err","reason","_this$opts$restrictio","smart_count","isCorrectFileType","some","replace","extension","toLowerCase","substr","allowedFileTypesString","join","types","size","totalFilesSize","backwardsCompat","_checkMinNumberOfFiles","_showOrLogErrorAndThrow","_temp","_ref","_ref$showInformer","showInformer","_ref$file","_ref$throwErr","throwErr","details","logMessageWithDetails","_assertNewUploadAllowed","_this$getState2","_checkAndCreateFileStateObject","fileType","onBeforeFileAddedResult","fileName","name","split","fileExtension","isRemote","isFinite","newFile","bytesTotal","remote","preview","filesArray","_startIfAutoProceed","_this3","scheduledAutoProceed","setTimeout","catch","stack","_extends3","_this$getState3","addFiles","fileDescriptors","_this4","newFiles","errors","subError","removeFiles","fileIDs","_this5","_this$getState4","updatedUploads","removedFiles","fileIsNotRemoved","uploadFileID","uploadsToRemove","uploadID","newFileIDs","stateUpdate","error","_calculateTotalProgress","removedFileIDs","wasPaused","isPaused","inProgressUpdatedFiles","filesToRetry","Promise","resolve","successful","failed","_createUpload","forceAllowNewUpload","_runUpload","_this$getState5","reset","canHavePercentage","Math","round","inProgress","preprocess","postprocess","sizedFiles","unsizedFiles","progressMax","currentProgress","reduce","acc","_totalProgress","totalSize","averageSize","uploadedSize","_this6","errorMsg","response","newError","Date","now","uploadResp","mode","uploadURL","addEventListener","online","navigator","onLine","wasOffline","getID","use","msg","pluginId","existsPluginAlready","_msg","install","foundPlugin","method","_this7","pluginType","removePlugin","_extends4","uninstall","list","slice","index","item","updatedState","close","_this8","duration","isComplexMessage","clearTimeout","infoTimeoutID","newInfo","warn","run","restore","_removeUpload","reject","_extends5","_opts","_opts$forceAllowNewUp","_this$getState6","step","_getUpload","_this$getState7","addResultData","_extends6","currentUpload","_this9","uploadData","restoreStep","steps","lastStep","then","_extends7","_this9$getState","updatedUpload","_this9$getState2","_this9$getState3","_this10","uploader","onBeforeUploadResult","_this10$getState","currentlyUploadingFiles","prev","curr","waitingFileIDs","module","exports"],"mappings":"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","sourcesContent":["function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _inheritsLoose(subClass, superClass) { subClass.prototype = Object.create(superClass.prototype); subClass.prototype.constructor = subClass; _setPrototypeOf(subClass, superClass); }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nvar Translator = require('@uppy/utils/lib/Translator');\n\nvar ee = require('namespace-emitter');\n\nvar cuid = require('cuid');\n\nvar throttle = require('lodash.throttle');\n\nvar prettierBytes = require('@transloadit/prettier-bytes');\n\nvar match = require('mime-match');\n\nvar DefaultStore = require('@uppy/store-default');\n\nvar getFileType = require('@uppy/utils/lib/getFileType');\n\nvar getFileNameAndExtension = require('@uppy/utils/lib/getFileNameAndExtension');\n\nvar generateFileID = require('@uppy/utils/lib/generateFileID');\n\nvar findIndex = require('@uppy/utils/lib/findIndex');\n\nvar supportsUploadProgress = require('./supportsUploadProgress');\n\nvar _require = require('./loggers'),\n    justErrorsLogger = _require.justErrorsLogger,\n    debugLogger = _require.debugLogger;\n\nvar Plugin = require('./Plugin'); // Exported from here.\n\n\nvar RestrictionError = /*#__PURE__*/function (_Error) {\n  _inheritsLoose(RestrictionError, _Error);\n\n  function RestrictionError() {\n    var _this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _Error.call.apply(_Error, [this].concat(args)) || this;\n    _this.isRestriction = true;\n    return _this;\n  }\n\n  return RestrictionError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n/**\n * Uppy Core module.\n * Manages plugins, state updates, acts as an event bus,\n * adds/removes files and metadata.\n */\n\n\nvar Uppy = /*#__PURE__*/function () {\n  /**\n   * Instantiate Uppy\n   *\n   * @param {object} opts — Uppy options\n   */\n  function Uppy(opts) {\n    var _this2 = this;\n\n    this.defaultLocale = {\n      strings: {\n        addBulkFilesFailed: {\n          0: 'Failed to add %{smart_count} file due to an internal error',\n          1: 'Failed to add %{smart_count} files due to internal errors'\n        },\n        youCanOnlyUploadX: {\n          0: 'You can only upload %{smart_count} file',\n          1: 'You can only upload %{smart_count} files'\n        },\n        youHaveToAtLeastSelectX: {\n          0: 'You have to select at least %{smart_count} file',\n          1: 'You have to select at least %{smart_count} files'\n        },\n        // The default `exceedsSize2` string only combines the `exceedsSize` string (%{backwardsCompat}) with the size.\n        // Locales can override `exceedsSize2` to specify a different word order. This is for backwards compat with\n        // Uppy 1.9.x and below which did a naive concatenation of `exceedsSize2 + size` instead of using a locale-specific\n        // substitution.\n        // TODO: In 2.0 `exceedsSize2` should be removed in and `exceedsSize` updated to use substitution.\n        exceedsSize2: '%{backwardsCompat} %{size}',\n        exceedsSize: 'This file exceeds maximum allowed size of',\n        inferiorSize: 'This file is smaller than the allowed size of %{size}',\n        youCanOnlyUploadFileTypes: 'You can only upload: %{types}',\n        noNewAlreadyUploading: 'Cannot add new files: already uploading',\n        noDuplicates: 'Cannot add the duplicate file \\'%{fileName}\\', it already exists',\n        companionError: 'Connection with Companion failed',\n        companionUnauthorizeHint: 'To unauthorize to your %{provider} account, please go to %{url}',\n        failedToUpload: 'Failed to upload %{file}',\n        noInternetConnection: 'No Internet connection',\n        connectedToInternet: 'Connected to the Internet',\n        // Strings for remote providers\n        noFilesFound: 'You have no files or folders here',\n        selectX: {\n          0: 'Select %{smart_count}',\n          1: 'Select %{smart_count}'\n        },\n        selectAllFilesFromFolderNamed: 'Select all files from folder %{name}',\n        unselectAllFilesFromFolderNamed: 'Unselect all files from folder %{name}',\n        selectFileNamed: 'Select file %{name}',\n        unselectFileNamed: 'Unselect file %{name}',\n        openFolderNamed: 'Open folder %{name}',\n        cancel: 'Cancel',\n        logOut: 'Log out',\n        filter: 'Filter',\n        resetFilter: 'Reset filter',\n        loading: 'Loading...',\n        authenticateWithTitle: 'Please authenticate with %{pluginName} to select files',\n        authenticateWith: 'Connect to %{pluginName}',\n        searchImages: 'Search for images',\n        enterTextToSearch: 'Enter text to search for images',\n        backToSearch: 'Back to Search',\n        emptyFolderAdded: 'No files were added from empty folder',\n        folderAdded: {\n          0: 'Added %{smart_count} file from %{folder}',\n          1: 'Added %{smart_count} files from %{folder}'\n        }\n      }\n    };\n    var defaultOptions = {\n      id: 'uppy',\n      autoProceed: false,\n      allowMultipleUploads: true,\n      debug: false,\n      restrictions: {\n        maxFileSize: null,\n        minFileSize: null,\n        maxTotalFileSize: null,\n        maxNumberOfFiles: null,\n        minNumberOfFiles: null,\n        allowedFileTypes: null\n      },\n      meta: {},\n      onBeforeFileAdded: function onBeforeFileAdded(currentFile, files) {\n        return currentFile;\n      },\n      onBeforeUpload: function onBeforeUpload(files) {\n        return files;\n      },\n      store: DefaultStore(),\n      logger: justErrorsLogger,\n      infoTimeout: 5000\n    }; // Merge default options with the ones set by user,\n    // making sure to merge restrictions too\n\n    this.opts = _extends({}, defaultOptions, opts, {\n      restrictions: _extends({}, defaultOptions.restrictions, opts && opts.restrictions)\n    }); // Support debug: true for backwards-compatability, unless logger is set in opts\n    // opts instead of this.opts to avoid comparing objects — we set logger: justErrorsLogger in defaultOptions\n\n    if (opts && opts.logger && opts.debug) {\n      this.log('You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.', 'warning');\n    } else if (opts && opts.debug) {\n      this.opts.logger = debugLogger;\n    }\n\n    this.log(\"Using Core v\" + this.constructor.VERSION);\n\n    if (this.opts.restrictions.allowedFileTypes && this.opts.restrictions.allowedFileTypes !== null && !Array.isArray(this.opts.restrictions.allowedFileTypes)) {\n      throw new TypeError('`restrictions.allowedFileTypes` must be an array');\n    }\n\n    this.i18nInit(); // Container for different types of plugins\n\n    this.plugins = {};\n    this.getState = this.getState.bind(this);\n    this.getPlugin = this.getPlugin.bind(this);\n    this.setFileMeta = this.setFileMeta.bind(this);\n    this.setFileState = this.setFileState.bind(this);\n    this.log = this.log.bind(this);\n    this.info = this.info.bind(this);\n    this.hideInfo = this.hideInfo.bind(this);\n    this.addFile = this.addFile.bind(this);\n    this.removeFile = this.removeFile.bind(this);\n    this.pauseResume = this.pauseResume.bind(this);\n    this.validateRestrictions = this.validateRestrictions.bind(this); // ___Why throttle at 500ms?\n    //    - We must throttle at >250ms for superfocus in Dashboard to work well (because animation takes 0.25s, and we want to wait for all animations to be over before refocusing).\n    //    [Practical Check]: if thottle is at 100ms, then if you are uploading a file, and click 'ADD MORE FILES', - focus won't activate in Firefox.\n    //    - We must throttle at around >500ms to avoid performance lags.\n    //    [Practical Check] Firefox, try to upload a big file for a prolonged period of time. Laptop will start to heat up.\n\n    this._calculateProgress = throttle(this._calculateProgress.bind(this), 500, {\n      leading: true,\n      trailing: true\n    });\n    this.updateOnlineStatus = this.updateOnlineStatus.bind(this);\n    this.resetProgress = this.resetProgress.bind(this);\n    this.pauseAll = this.pauseAll.bind(this);\n    this.resumeAll = this.resumeAll.bind(this);\n    this.retryAll = this.retryAll.bind(this);\n    this.cancelAll = this.cancelAll.bind(this);\n    this.retryUpload = this.retryUpload.bind(this);\n    this.upload = this.upload.bind(this);\n    this.emitter = ee();\n    this.on = this.on.bind(this);\n    this.off = this.off.bind(this);\n    this.once = this.emitter.once.bind(this.emitter);\n    this.emit = this.emitter.emit.bind(this.emitter);\n    this.preProcessors = [];\n    this.uploaders = [];\n    this.postProcessors = [];\n    this.store = this.opts.store;\n    this.setState({\n      plugins: {},\n      files: {},\n      currentUploads: {},\n      allowNewUpload: true,\n      capabilities: {\n        uploadProgress: supportsUploadProgress(),\n        individualCancellation: true,\n        resumableUploads: false\n      },\n      totalProgress: 0,\n      meta: _extends({}, this.opts.meta),\n      info: {\n        isHidden: true,\n        type: 'info',\n        message: ''\n      }\n    });\n    this._storeUnsubscribe = this.store.subscribe(function (prevState, nextState, patch) {\n      _this2.emit('state-update', prevState, nextState, patch);\n\n      _this2.updateAll(nextState);\n    }); // Exposing uppy object on window for debugging and testing\n\n    if (this.opts.debug && typeof window !== 'undefined') {\n      window[this.opts.id] = this;\n    }\n\n    this._addListeners(); // Re-enable if we’ll need some capabilities on boot, like isMobileDevice\n    // this._setCapabilities()\n\n  } // _setCapabilities = () => {\n  //   const capabilities = {\n  //     isMobileDevice: isMobileDevice()\n  //   }\n  //   this.setState({\n  //     ...this.getState().capabilities,\n  //     capabilities\n  //   })\n  // }\n\n\n  var _proto = Uppy.prototype;\n\n  _proto.on = function on(event, callback) {\n    this.emitter.on(event, callback);\n    return this;\n  };\n\n  _proto.off = function off(event, callback) {\n    this.emitter.off(event, callback);\n    return this;\n  }\n  /**\n   * Iterate on all plugins and run `update` on them.\n   * Called each time state changes.\n   *\n   */\n  ;\n\n  _proto.updateAll = function updateAll(state) {\n    this.iteratePlugins(function (plugin) {\n      plugin.update(state);\n    });\n  }\n  /**\n   * Updates state with a patch\n   *\n   * @param {object} patch {foo: 'bar'}\n   */\n  ;\n\n  _proto.setState = function setState(patch) {\n    this.store.setState(patch);\n  }\n  /**\n   * Returns current state.\n   *\n   * @returns {object}\n   */\n  ;\n\n  _proto.getState = function getState() {\n    return this.store.getState();\n  }\n  /**\n   * Back compat for when uppy.state is used instead of uppy.getState().\n   */\n  ;\n\n  /**\n   * Shorthand to set state for a specific file.\n   */\n  _proto.setFileState = function setFileState(fileID, state) {\n    var _extends2;\n\n    if (!this.getState().files[fileID]) {\n      throw new Error(\"Can\\u2019t set state for \" + fileID + \" (the file could have been removed)\");\n    }\n\n    this.setState({\n      files: _extends({}, this.getState().files, (_extends2 = {}, _extends2[fileID] = _extends({}, this.getState().files[fileID], state), _extends2))\n    });\n  };\n\n  _proto.i18nInit = function i18nInit() {\n    this.translator = new Translator([this.defaultLocale, this.opts.locale]);\n    this.locale = this.translator.locale;\n    this.i18n = this.translator.translate.bind(this.translator);\n    this.i18nArray = this.translator.translateArray.bind(this.translator);\n  };\n\n  _proto.setOptions = function setOptions(newOpts) {\n    this.opts = _extends({}, this.opts, newOpts, {\n      restrictions: _extends({}, this.opts.restrictions, newOpts && newOpts.restrictions)\n    });\n\n    if (newOpts.meta) {\n      this.setMeta(newOpts.meta);\n    }\n\n    this.i18nInit();\n\n    if (newOpts.locale) {\n      this.iteratePlugins(function (plugin) {\n        plugin.setOptions();\n      });\n    }\n\n    this.setState(); // so that UI re-renders with new options\n  };\n\n  _proto.resetProgress = function resetProgress() {\n    var defaultProgress = {\n      percentage: 0,\n      bytesUploaded: 0,\n      uploadComplete: false,\n      uploadStarted: null\n    };\n\n    var files = _extends({}, this.getState().files);\n\n    var updatedFiles = {};\n    Object.keys(files).forEach(function (fileID) {\n      var updatedFile = _extends({}, files[fileID]);\n\n      updatedFile.progress = _extends({}, updatedFile.progress, defaultProgress);\n      updatedFiles[fileID] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles,\n      totalProgress: 0\n    });\n    this.emit('reset-progress');\n  };\n\n  _proto.addPreProcessor = function addPreProcessor(fn) {\n    this.preProcessors.push(fn);\n  };\n\n  _proto.removePreProcessor = function removePreProcessor(fn) {\n    var i = this.preProcessors.indexOf(fn);\n\n    if (i !== -1) {\n      this.preProcessors.splice(i, 1);\n    }\n  };\n\n  _proto.addPostProcessor = function addPostProcessor(fn) {\n    this.postProcessors.push(fn);\n  };\n\n  _proto.removePostProcessor = function removePostProcessor(fn) {\n    var i = this.postProcessors.indexOf(fn);\n\n    if (i !== -1) {\n      this.postProcessors.splice(i, 1);\n    }\n  };\n\n  _proto.addUploader = function addUploader(fn) {\n    this.uploaders.push(fn);\n  };\n\n  _proto.removeUploader = function removeUploader(fn) {\n    var i = this.uploaders.indexOf(fn);\n\n    if (i !== -1) {\n      this.uploaders.splice(i, 1);\n    }\n  };\n\n  _proto.setMeta = function setMeta(data) {\n    var updatedMeta = _extends({}, this.getState().meta, data);\n\n    var updatedFiles = _extends({}, this.getState().files);\n\n    Object.keys(updatedFiles).forEach(function (fileID) {\n      updatedFiles[fileID] = _extends({}, updatedFiles[fileID], {\n        meta: _extends({}, updatedFiles[fileID].meta, data)\n      });\n    });\n    this.log('Adding metadata:');\n    this.log(data);\n    this.setState({\n      meta: updatedMeta,\n      files: updatedFiles\n    });\n  };\n\n  _proto.setFileMeta = function setFileMeta(fileID, data) {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    if (!updatedFiles[fileID]) {\n      this.log('Was trying to set metadata for a file that has been removed: ', fileID);\n      return;\n    }\n\n    var newMeta = _extends({}, updatedFiles[fileID].meta, data);\n\n    updatedFiles[fileID] = _extends({}, updatedFiles[fileID], {\n      meta: newMeta\n    });\n    this.setState({\n      files: updatedFiles\n    });\n  }\n  /**\n   * Get a file object.\n   *\n   * @param {string} fileID The ID of the file object to return.\n   */\n  ;\n\n  _proto.getFile = function getFile(fileID) {\n    return this.getState().files[fileID];\n  }\n  /**\n   * Get all files in an array.\n   */\n  ;\n\n  _proto.getFiles = function getFiles() {\n    var _this$getState = this.getState(),\n        files = _this$getState.files;\n\n    return Object.keys(files).map(function (fileID) {\n      return files[fileID];\n    });\n  }\n  /**\n   * A public wrapper for _checkRestrictions — checks if a file passes a set of restrictions.\n   * For use in UI pluigins (like Providers), to disallow selecting files that won’t pass restrictions.\n   *\n   * @param {object} file object to check\n   * @param {Array} [files] array to check maxNumberOfFiles and maxTotalFileSize\n   * @returns {object} { result: true/false, reason: why file didn’t pass restrictions }\n   */\n  ;\n\n  _proto.validateRestrictions = function validateRestrictions(file, files) {\n    try {\n      this._checkRestrictions(file, files);\n\n      return {\n        result: true\n      };\n    } catch (err) {\n      return {\n        result: false,\n        reason: err.message\n      };\n    }\n  }\n  /**\n   * Check if file passes a set of restrictions set in options: maxFileSize, minFileSize,\n   * maxNumberOfFiles and allowedFileTypes.\n   *\n   * @param {object} file object to check\n   * @param {Array} [files] array to check maxNumberOfFiles and maxTotalFileSize\n   * @private\n   */\n  ;\n\n  _proto._checkRestrictions = function _checkRestrictions(file, files) {\n    if (files === void 0) {\n      files = this.getFiles();\n    }\n\n    var _this$opts$restrictio = this.opts.restrictions,\n        maxFileSize = _this$opts$restrictio.maxFileSize,\n        minFileSize = _this$opts$restrictio.minFileSize,\n        maxTotalFileSize = _this$opts$restrictio.maxTotalFileSize,\n        maxNumberOfFiles = _this$opts$restrictio.maxNumberOfFiles,\n        allowedFileTypes = _this$opts$restrictio.allowedFileTypes;\n\n    if (maxNumberOfFiles) {\n      if (files.length + 1 > maxNumberOfFiles) {\n        throw new RestrictionError(\"\" + this.i18n('youCanOnlyUploadX', {\n          smart_count: maxNumberOfFiles\n        }));\n      }\n    }\n\n    if (allowedFileTypes) {\n      var isCorrectFileType = allowedFileTypes.some(function (type) {\n        // check if this is a mime-type\n        if (type.indexOf('/') > -1) {\n          if (!file.type) return false;\n          return match(file.type.replace(/;.*?$/, ''), type);\n        } // otherwise this is likely an extension\n\n\n        if (type[0] === '.' && file.extension) {\n          return file.extension.toLowerCase() === type.substr(1).toLowerCase();\n        }\n\n        return false;\n      });\n\n      if (!isCorrectFileType) {\n        var allowedFileTypesString = allowedFileTypes.join(', ');\n        throw new RestrictionError(this.i18n('youCanOnlyUploadFileTypes', {\n          types: allowedFileTypesString\n        }));\n      }\n    } // We can't check maxTotalFileSize if the size is unknown.\n\n\n    if (maxTotalFileSize && file.size != null) {\n      var totalFilesSize = 0;\n      totalFilesSize += file.size;\n      files.forEach(function (file) {\n        totalFilesSize += file.size;\n      });\n\n      if (totalFilesSize > maxTotalFileSize) {\n        throw new RestrictionError(this.i18n('exceedsSize2', {\n          backwardsCompat: this.i18n('exceedsSize'),\n          size: prettierBytes(maxTotalFileSize)\n        }));\n      }\n    } // We can't check maxFileSize if the size is unknown.\n\n\n    if (maxFileSize && file.size != null) {\n      if (file.size > maxFileSize) {\n        throw new RestrictionError(this.i18n('exceedsSize2', {\n          backwardsCompat: this.i18n('exceedsSize'),\n          size: prettierBytes(maxFileSize)\n        }));\n      }\n    } // We can't check minFileSize if the size is unknown.\n\n\n    if (minFileSize && file.size != null) {\n      if (file.size < minFileSize) {\n        throw new RestrictionError(this.i18n('inferiorSize', {\n          size: prettierBytes(minFileSize)\n        }));\n      }\n    }\n  }\n  /**\n   * Check if minNumberOfFiles restriction is reached before uploading.\n   *\n   * @private\n   */\n  ;\n\n  _proto._checkMinNumberOfFiles = function _checkMinNumberOfFiles(files) {\n    var minNumberOfFiles = this.opts.restrictions.minNumberOfFiles;\n\n    if (Object.keys(files).length < minNumberOfFiles) {\n      throw new RestrictionError(\"\" + this.i18n('youHaveToAtLeastSelectX', {\n        smart_count: minNumberOfFiles\n      }));\n    }\n  }\n  /**\n   * Logs an error, sets Informer message, then throws the error.\n   * Emits a 'restriction-failed' event if it’s a restriction error\n   *\n   * @param {object | string} err — Error object or plain string message\n   * @param {object} [options]\n   * @param {boolean} [options.showInformer=true] — Sometimes developer might want to show Informer manually\n   * @param {object} [options.file=null] — File object used to emit the restriction error\n   * @param {boolean} [options.throwErr=true] — Errors shouldn’t be thrown, for example, in `upload-error` event\n   * @private\n   */\n  ;\n\n  _proto._showOrLogErrorAndThrow = function _showOrLogErrorAndThrow(err, _temp) {\n    var _ref = _temp === void 0 ? {} : _temp,\n        _ref$showInformer = _ref.showInformer,\n        showInformer = _ref$showInformer === void 0 ? true : _ref$showInformer,\n        _ref$file = _ref.file,\n        file = _ref$file === void 0 ? null : _ref$file,\n        _ref$throwErr = _ref.throwErr,\n        throwErr = _ref$throwErr === void 0 ? true : _ref$throwErr;\n\n    var message = typeof err === 'object' ? err.message : err;\n    var details = typeof err === 'object' && err.details ? err.details : ''; // Restriction errors should be logged, but not as errors,\n    // as they are expected and shown in the UI.\n\n    var logMessageWithDetails = message;\n\n    if (details) {\n      logMessageWithDetails += \" \" + details;\n    }\n\n    if (err.isRestriction) {\n      this.log(logMessageWithDetails);\n      this.emit('restriction-failed', file, err);\n    } else {\n      this.log(logMessageWithDetails, 'error');\n    } // Sometimes informer has to be shown manually by the developer,\n    // for example, in `onBeforeFileAdded`.\n\n\n    if (showInformer) {\n      this.info({\n        message: message,\n        details: details\n      }, 'error', this.opts.infoTimeout);\n    }\n\n    if (throwErr) {\n      throw typeof err === 'object' ? err : new Error(err);\n    }\n  };\n\n  _proto._assertNewUploadAllowed = function _assertNewUploadAllowed(file) {\n    var _this$getState2 = this.getState(),\n        allowNewUpload = _this$getState2.allowNewUpload;\n\n    if (allowNewUpload === false) {\n      this._showOrLogErrorAndThrow(new RestrictionError(this.i18n('noNewAlreadyUploading')), {\n        file: file\n      });\n    }\n  }\n  /**\n   * Create a file state object based on user-provided `addFile()` options.\n   *\n   * Note this is extremely side-effectful and should only be done when a file state object will be added to state immediately afterward!\n   *\n   * The `files` value is passed in because it may be updated by the caller without updating the store.\n   */\n  ;\n\n  _proto._checkAndCreateFileStateObject = function _checkAndCreateFileStateObject(files, file) {\n    var fileType = getFileType(file);\n    file.type = fileType;\n    var onBeforeFileAddedResult = this.opts.onBeforeFileAdded(file, files);\n\n    if (onBeforeFileAddedResult === false) {\n      // Don’t show UI info for this error, as it should be done by the developer\n      this._showOrLogErrorAndThrow(new RestrictionError('Cannot add the file because onBeforeFileAdded returned false.'), {\n        showInformer: false,\n        file: file\n      });\n    }\n\n    if (typeof onBeforeFileAddedResult === 'object' && onBeforeFileAddedResult) {\n      file = onBeforeFileAddedResult;\n    }\n\n    var fileName;\n\n    if (file.name) {\n      fileName = file.name;\n    } else if (fileType.split('/')[0] === 'image') {\n      fileName = fileType.split('/')[0] + \".\" + fileType.split('/')[1];\n    } else {\n      fileName = 'noname';\n    }\n\n    var fileExtension = getFileNameAndExtension(fileName).extension;\n    var isRemote = file.isRemote || false;\n    var fileID = generateFileID(file);\n\n    if (files[fileID]) {\n      this._showOrLogErrorAndThrow(new RestrictionError(this.i18n('noDuplicates', {\n        fileName: fileName\n      })), {\n        file: file\n      });\n    }\n\n    var meta = file.meta || {};\n    meta.name = fileName;\n    meta.type = fileType; // `null` means the size is unknown.\n\n    var size = isFinite(file.data.size) ? file.data.size : null;\n    var newFile = {\n      source: file.source || '',\n      id: fileID,\n      name: fileName,\n      extension: fileExtension || '',\n      meta: _extends({}, this.getState().meta, meta),\n      type: fileType,\n      data: file.data,\n      progress: {\n        percentage: 0,\n        bytesUploaded: 0,\n        bytesTotal: size,\n        uploadComplete: false,\n        uploadStarted: null\n      },\n      size: size,\n      isRemote: isRemote,\n      remote: file.remote || '',\n      preview: file.preview\n    };\n\n    try {\n      var filesArray = Object.keys(files).map(function (i) {\n        return files[i];\n      });\n\n      this._checkRestrictions(newFile, filesArray);\n    } catch (err) {\n      this._showOrLogErrorAndThrow(err, {\n        file: newFile\n      });\n    }\n\n    return newFile;\n  } // Schedule an upload if `autoProceed` is enabled.\n  ;\n\n  _proto._startIfAutoProceed = function _startIfAutoProceed() {\n    var _this3 = this;\n\n    if (this.opts.autoProceed && !this.scheduledAutoProceed) {\n      this.scheduledAutoProceed = setTimeout(function () {\n        _this3.scheduledAutoProceed = null;\n\n        _this3.upload().catch(function (err) {\n          if (!err.isRestriction) {\n            _this3.log(err.stack || err.message || err);\n          }\n        });\n      }, 4);\n    }\n  }\n  /**\n   * Add a new file to `state.files`. This will run `onBeforeFileAdded`,\n   * try to guess file type in a clever way, check file against restrictions,\n   * and start an upload if `autoProceed === true`.\n   *\n   * @param {object} file object to add\n   * @returns {string} id for the added file\n   */\n  ;\n\n  _proto.addFile = function addFile(file) {\n    var _extends3;\n\n    this._assertNewUploadAllowed(file);\n\n    var _this$getState3 = this.getState(),\n        files = _this$getState3.files;\n\n    var newFile = this._checkAndCreateFileStateObject(files, file);\n\n    this.setState({\n      files: _extends({}, files, (_extends3 = {}, _extends3[newFile.id] = newFile, _extends3))\n    });\n    this.emit('file-added', newFile);\n    this.emit('files-added', [newFile]);\n    this.log(\"Added file: \" + newFile.name + \", \" + newFile.id + \", mime type: \" + newFile.type);\n\n    this._startIfAutoProceed();\n\n    return newFile.id;\n  }\n  /**\n   * Add multiple files to `state.files`. See the `addFile()` documentation.\n   *\n   * This cuts some corners for performance, so should typically only be used in cases where there may be a lot of files.\n   *\n   * If an error occurs while adding a file, it is logged and the user is notified. This is good for UI plugins, but not for programmatic use. Programmatic users should usually still use `addFile()` on individual files.\n   */\n  ;\n\n  _proto.addFiles = function addFiles(fileDescriptors) {\n    var _this4 = this;\n\n    this._assertNewUploadAllowed(); // create a copy of the files object only once\n\n\n    var files = _extends({}, this.getState().files);\n\n    var newFiles = [];\n    var errors = [];\n\n    for (var i = 0; i < fileDescriptors.length; i++) {\n      try {\n        var newFile = this._checkAndCreateFileStateObject(files, fileDescriptors[i]);\n\n        newFiles.push(newFile);\n        files[newFile.id] = newFile;\n      } catch (err) {\n        if (!err.isRestriction) {\n          errors.push(err);\n        }\n      }\n    }\n\n    this.setState({\n      files: files\n    });\n    newFiles.forEach(function (newFile) {\n      _this4.emit('file-added', newFile);\n    });\n    this.emit('files-added', newFiles);\n\n    if (newFiles.length > 5) {\n      this.log(\"Added batch of \" + newFiles.length + \" files\");\n    } else {\n      Object.keys(newFiles).forEach(function (fileID) {\n        _this4.log(\"Added file: \" + newFiles[fileID].name + \"\\n id: \" + newFiles[fileID].id + \"\\n type: \" + newFiles[fileID].type);\n      });\n    }\n\n    if (newFiles.length > 0) {\n      this._startIfAutoProceed();\n    }\n\n    if (errors.length > 0) {\n      var message = 'Multiple errors occurred while adding files:\\n';\n      errors.forEach(function (subError) {\n        message += \"\\n * \" + subError.message;\n      });\n      this.info({\n        message: this.i18n('addBulkFilesFailed', {\n          smart_count: errors.length\n        }),\n        details: message\n      }, 'error', this.opts.infoTimeout);\n      var err = new Error(message);\n      err.errors = errors;\n      throw err;\n    }\n  };\n\n  _proto.removeFiles = function removeFiles(fileIDs, reason) {\n    var _this5 = this;\n\n    var _this$getState4 = this.getState(),\n        files = _this$getState4.files,\n        currentUploads = _this$getState4.currentUploads;\n\n    var updatedFiles = _extends({}, files);\n\n    var updatedUploads = _extends({}, currentUploads);\n\n    var removedFiles = Object.create(null);\n    fileIDs.forEach(function (fileID) {\n      if (files[fileID]) {\n        removedFiles[fileID] = files[fileID];\n        delete updatedFiles[fileID];\n      }\n    }); // Remove files from the `fileIDs` list in each upload.\n\n    function fileIsNotRemoved(uploadFileID) {\n      return removedFiles[uploadFileID] === undefined;\n    }\n\n    var uploadsToRemove = [];\n    Object.keys(updatedUploads).forEach(function (uploadID) {\n      var newFileIDs = currentUploads[uploadID].fileIDs.filter(fileIsNotRemoved); // Remove the upload if no files are associated with it anymore.\n\n      if (newFileIDs.length === 0) {\n        uploadsToRemove.push(uploadID);\n        return;\n      }\n\n      updatedUploads[uploadID] = _extends({}, currentUploads[uploadID], {\n        fileIDs: newFileIDs\n      });\n    });\n    uploadsToRemove.forEach(function (uploadID) {\n      delete updatedUploads[uploadID];\n    });\n    var stateUpdate = {\n      currentUploads: updatedUploads,\n      files: updatedFiles\n    }; // If all files were removed - allow new uploads!\n\n    if (Object.keys(updatedFiles).length === 0) {\n      stateUpdate.allowNewUpload = true;\n      stateUpdate.error = null;\n    }\n\n    this.setState(stateUpdate);\n\n    this._calculateTotalProgress();\n\n    var removedFileIDs = Object.keys(removedFiles);\n    removedFileIDs.forEach(function (fileID) {\n      _this5.emit('file-removed', removedFiles[fileID], reason);\n    });\n\n    if (removedFileIDs.length > 5) {\n      this.log(\"Removed \" + removedFileIDs.length + \" files\");\n    } else {\n      this.log(\"Removed files: \" + removedFileIDs.join(', '));\n    }\n  };\n\n  _proto.removeFile = function removeFile(fileID, reason) {\n    if (reason === void 0) {\n      reason = null;\n    }\n\n    this.removeFiles([fileID], reason);\n  };\n\n  _proto.pauseResume = function pauseResume(fileID) {\n    if (!this.getState().capabilities.resumableUploads || this.getFile(fileID).uploadComplete) {\n      return;\n    }\n\n    var wasPaused = this.getFile(fileID).isPaused || false;\n    var isPaused = !wasPaused;\n    this.setFileState(fileID, {\n      isPaused: isPaused\n    });\n    this.emit('upload-pause', fileID, isPaused);\n    return isPaused;\n  };\n\n  _proto.pauseAll = function pauseAll() {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    var inProgressUpdatedFiles = Object.keys(updatedFiles).filter(function (file) {\n      return !updatedFiles[file].progress.uploadComplete && updatedFiles[file].progress.uploadStarted;\n    });\n    inProgressUpdatedFiles.forEach(function (file) {\n      var updatedFile = _extends({}, updatedFiles[file], {\n        isPaused: true\n      });\n\n      updatedFiles[file] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles\n    });\n    this.emit('pause-all');\n  };\n\n  _proto.resumeAll = function resumeAll() {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    var inProgressUpdatedFiles = Object.keys(updatedFiles).filter(function (file) {\n      return !updatedFiles[file].progress.uploadComplete && updatedFiles[file].progress.uploadStarted;\n    });\n    inProgressUpdatedFiles.forEach(function (file) {\n      var updatedFile = _extends({}, updatedFiles[file], {\n        isPaused: false,\n        error: null\n      });\n\n      updatedFiles[file] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles\n    });\n    this.emit('resume-all');\n  };\n\n  _proto.retryAll = function retryAll() {\n    var updatedFiles = _extends({}, this.getState().files);\n\n    var filesToRetry = Object.keys(updatedFiles).filter(function (file) {\n      return updatedFiles[file].error;\n    });\n    filesToRetry.forEach(function (file) {\n      var updatedFile = _extends({}, updatedFiles[file], {\n        isPaused: false,\n        error: null\n      });\n\n      updatedFiles[file] = updatedFile;\n    });\n    this.setState({\n      files: updatedFiles,\n      error: null\n    });\n    this.emit('retry-all', filesToRetry);\n\n    if (filesToRetry.length === 0) {\n      return Promise.resolve({\n        successful: [],\n        failed: []\n      });\n    }\n\n    var uploadID = this._createUpload(filesToRetry, {\n      forceAllowNewUpload: true // create new upload even if allowNewUpload: false\n\n    });\n\n    return this._runUpload(uploadID);\n  };\n\n  _proto.cancelAll = function cancelAll() {\n    this.emit('cancel-all');\n\n    var _this$getState5 = this.getState(),\n        files = _this$getState5.files;\n\n    var fileIDs = Object.keys(files);\n\n    if (fileIDs.length) {\n      this.removeFiles(fileIDs, 'cancel-all');\n    }\n\n    this.setState({\n      totalProgress: 0,\n      error: null\n    });\n  };\n\n  _proto.retryUpload = function retryUpload(fileID) {\n    this.setFileState(fileID, {\n      error: null,\n      isPaused: false\n    });\n    this.emit('upload-retry', fileID);\n\n    var uploadID = this._createUpload([fileID], {\n      forceAllowNewUpload: true // create new upload even if allowNewUpload: false\n\n    });\n\n    return this._runUpload(uploadID);\n  };\n\n  _proto.reset = function reset() {\n    this.cancelAll();\n  };\n\n  _proto._calculateProgress = function _calculateProgress(file, data) {\n    if (!this.getFile(file.id)) {\n      this.log(\"Not setting progress for a file that has been removed: \" + file.id);\n      return;\n    } // bytesTotal may be null or zero; in that case we can't divide by it\n\n\n    var canHavePercentage = isFinite(data.bytesTotal) && data.bytesTotal > 0;\n    this.setFileState(file.id, {\n      progress: _extends({}, this.getFile(file.id).progress, {\n        bytesUploaded: data.bytesUploaded,\n        bytesTotal: data.bytesTotal,\n        percentage: canHavePercentage // TODO(goto-bus-stop) flooring this should probably be the choice of the UI?\n        // we get more accurate calculations if we don't round this at all.\n        ? Math.round(data.bytesUploaded / data.bytesTotal * 100) : 0\n      })\n    });\n\n    this._calculateTotalProgress();\n  };\n\n  _proto._calculateTotalProgress = function _calculateTotalProgress() {\n    // calculate total progress, using the number of files currently uploading,\n    // multiplied by 100 and the summ of individual progress of each file\n    var files = this.getFiles();\n    var inProgress = files.filter(function (file) {\n      return file.progress.uploadStarted || file.progress.preprocess || file.progress.postprocess;\n    });\n\n    if (inProgress.length === 0) {\n      this.emit('progress', 0);\n      this.setState({\n        totalProgress: 0\n      });\n      return;\n    }\n\n    var sizedFiles = inProgress.filter(function (file) {\n      return file.progress.bytesTotal != null;\n    });\n    var unsizedFiles = inProgress.filter(function (file) {\n      return file.progress.bytesTotal == null;\n    });\n\n    if (sizedFiles.length === 0) {\n      var progressMax = inProgress.length * 100;\n      var currentProgress = unsizedFiles.reduce(function (acc, file) {\n        return acc + file.progress.percentage;\n      }, 0);\n\n      var _totalProgress = Math.round(currentProgress / progressMax * 100);\n\n      this.setState({\n        totalProgress: _totalProgress\n      });\n      return;\n    }\n\n    var totalSize = sizedFiles.reduce(function (acc, file) {\n      return acc + file.progress.bytesTotal;\n    }, 0);\n    var averageSize = totalSize / sizedFiles.length;\n    totalSize += averageSize * unsizedFiles.length;\n    var uploadedSize = 0;\n    sizedFiles.forEach(function (file) {\n      uploadedSize += file.progress.bytesUploaded;\n    });\n    unsizedFiles.forEach(function (file) {\n      uploadedSize += averageSize * (file.progress.percentage || 0) / 100;\n    });\n    var totalProgress = totalSize === 0 ? 0 : Math.round(uploadedSize / totalSize * 100); // hot fix, because:\n    // uploadedSize ended up larger than totalSize, resulting in 1325% total\n\n    if (totalProgress > 100) {\n      totalProgress = 100;\n    }\n\n    this.setState({\n      totalProgress: totalProgress\n    });\n    this.emit('progress', totalProgress);\n  }\n  /**\n   * Registers listeners for all global actions, like:\n   * `error`, `file-removed`, `upload-progress`\n   */\n  ;\n\n  _proto._addListeners = function _addListeners() {\n    var _this6 = this;\n\n    this.on('error', function (error) {\n      var errorMsg = 'Unknown error';\n\n      if (error.message) {\n        errorMsg = error.message;\n      }\n\n      if (error.details) {\n        errorMsg += \" \" + error.details;\n      }\n\n      _this6.setState({\n        error: errorMsg\n      });\n    });\n    this.on('upload-error', function (file, error, response) {\n      var errorMsg = 'Unknown error';\n\n      if (error.message) {\n        errorMsg = error.message;\n      }\n\n      if (error.details) {\n        errorMsg += \" \" + error.details;\n      }\n\n      _this6.setFileState(file.id, {\n        error: errorMsg,\n        response: response\n      });\n\n      _this6.setState({\n        error: error.message\n      });\n\n      if (typeof error === 'object' && error.message) {\n        var newError = new Error(error.message);\n        newError.details = error.message;\n\n        if (error.details) {\n          newError.details += \" \" + error.details;\n        }\n\n        newError.message = _this6.i18n('failedToUpload', {\n          file: file.name\n        });\n\n        _this6._showOrLogErrorAndThrow(newError, {\n          throwErr: false\n        });\n      } else {\n        _this6._showOrLogErrorAndThrow(error, {\n          throwErr: false\n        });\n      }\n    });\n    this.on('upload', function () {\n      _this6.setState({\n        error: null\n      });\n    });\n    this.on('upload-started', function (file, upload) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      _this6.setFileState(file.id, {\n        progress: {\n          uploadStarted: Date.now(),\n          uploadComplete: false,\n          percentage: 0,\n          bytesUploaded: 0,\n          bytesTotal: file.size\n        }\n      });\n    });\n    this.on('upload-progress', this._calculateProgress);\n    this.on('upload-success', function (file, uploadResp) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      var currentProgress = _this6.getFile(file.id).progress;\n\n      _this6.setFileState(file.id, {\n        progress: _extends({}, currentProgress, {\n          postprocess: _this6.postProcessors.length > 0 ? {\n            mode: 'indeterminate'\n          } : null,\n          uploadComplete: true,\n          percentage: 100,\n          bytesUploaded: currentProgress.bytesTotal\n        }),\n        response: uploadResp,\n        uploadURL: uploadResp.uploadURL,\n        isPaused: false\n      });\n\n      _this6._calculateTotalProgress();\n    });\n    this.on('preprocess-progress', function (file, progress) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      _this6.setFileState(file.id, {\n        progress: _extends({}, _this6.getFile(file.id).progress, {\n          preprocess: progress\n        })\n      });\n    });\n    this.on('preprocess-complete', function (file) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      var files = _extends({}, _this6.getState().files);\n\n      files[file.id] = _extends({}, files[file.id], {\n        progress: _extends({}, files[file.id].progress)\n      });\n      delete files[file.id].progress.preprocess;\n\n      _this6.setState({\n        files: files\n      });\n    });\n    this.on('postprocess-progress', function (file, progress) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      _this6.setFileState(file.id, {\n        progress: _extends({}, _this6.getState().files[file.id].progress, {\n          postprocess: progress\n        })\n      });\n    });\n    this.on('postprocess-complete', function (file) {\n      if (!_this6.getFile(file.id)) {\n        _this6.log(\"Not setting progress for a file that has been removed: \" + file.id);\n\n        return;\n      }\n\n      var files = _extends({}, _this6.getState().files);\n\n      files[file.id] = _extends({}, files[file.id], {\n        progress: _extends({}, files[file.id].progress)\n      });\n      delete files[file.id].progress.postprocess; // TODO should we set some kind of `fullyComplete` property on the file object\n      // so it's easier to see that the file is upload…fully complete…rather than\n      // what we have to do now (`uploadComplete && !postprocess`)\n\n      _this6.setState({\n        files: files\n      });\n    });\n    this.on('restored', function () {\n      // Files may have changed--ensure progress is still accurate.\n      _this6._calculateTotalProgress();\n    }); // show informer if offline\n\n    if (typeof window !== 'undefined' && window.addEventListener) {\n      window.addEventListener('online', function () {\n        return _this6.updateOnlineStatus();\n      });\n      window.addEventListener('offline', function () {\n        return _this6.updateOnlineStatus();\n      });\n      setTimeout(function () {\n        return _this6.updateOnlineStatus();\n      }, 3000);\n    }\n  };\n\n  _proto.updateOnlineStatus = function updateOnlineStatus() {\n    var online = typeof window.navigator.onLine !== 'undefined' ? window.navigator.onLine : true;\n\n    if (!online) {\n      this.emit('is-offline');\n      this.info(this.i18n('noInternetConnection'), 'error', 0);\n      this.wasOffline = true;\n    } else {\n      this.emit('is-online');\n\n      if (this.wasOffline) {\n        this.emit('back-online');\n        this.info(this.i18n('connectedToInternet'), 'success', 3000);\n        this.wasOffline = false;\n      }\n    }\n  };\n\n  _proto.getID = function getID() {\n    return this.opts.id;\n  }\n  /**\n   * Registers a plugin with Core.\n   *\n   * @param {object} Plugin object\n   * @param {object} [opts] object with options to be passed to Plugin\n   * @returns {object} self for chaining\n   */\n  ;\n\n  _proto.use = function use(Plugin, opts) {\n    if (typeof Plugin !== 'function') {\n      var msg = \"Expected a plugin class, but got \" + (Plugin === null ? 'null' : typeof Plugin) + \".\" + ' Please verify that the plugin was imported and spelled correctly.';\n      throw new TypeError(msg);\n    } // Instantiate\n\n\n    var plugin = new Plugin(this, opts);\n    var pluginId = plugin.id;\n    this.plugins[plugin.type] = this.plugins[plugin.type] || [];\n\n    if (!pluginId) {\n      throw new Error('Your plugin must have an id');\n    }\n\n    if (!plugin.type) {\n      throw new Error('Your plugin must have a type');\n    }\n\n    var existsPluginAlready = this.getPlugin(pluginId);\n\n    if (existsPluginAlready) {\n      var _msg = \"Already found a plugin named '\" + existsPluginAlready.id + \"'. \" + (\"Tried to use: '\" + pluginId + \"'.\\n\") + 'Uppy plugins must have unique `id` options. See https://uppy.io/docs/plugins/#id.';\n\n      throw new Error(_msg);\n    }\n\n    if (Plugin.VERSION) {\n      this.log(\"Using \" + pluginId + \" v\" + Plugin.VERSION);\n    }\n\n    this.plugins[plugin.type].push(plugin);\n    plugin.install();\n    return this;\n  }\n  /**\n   * Find one Plugin by name.\n   *\n   * @param {string} id plugin id\n   * @returns {object|boolean}\n   */\n  ;\n\n  _proto.getPlugin = function getPlugin(id) {\n    var foundPlugin = null;\n    this.iteratePlugins(function (plugin) {\n      if (plugin.id === id) {\n        foundPlugin = plugin;\n        return false;\n      }\n    });\n    return foundPlugin;\n  }\n  /**\n   * Iterate through all `use`d plugins.\n   *\n   * @param {Function} method that will be run on each plugin\n   */\n  ;\n\n  _proto.iteratePlugins = function iteratePlugins(method) {\n    var _this7 = this;\n\n    Object.keys(this.plugins).forEach(function (pluginType) {\n      _this7.plugins[pluginType].forEach(method);\n    });\n  }\n  /**\n   * Uninstall and remove a plugin.\n   *\n   * @param {object} instance The plugin instance to remove.\n   */\n  ;\n\n  _proto.removePlugin = function removePlugin(instance) {\n    var _extends4;\n\n    this.log(\"Removing plugin \" + instance.id);\n    this.emit('plugin-remove', instance);\n\n    if (instance.uninstall) {\n      instance.uninstall();\n    }\n\n    var list = this.plugins[instance.type].slice(); // list.indexOf failed here, because Vue3 converted the plugin instance\n    // to a Proxy object, which failed the strict comparison test:\n    // obj !== objProxy\n\n    var index = findIndex(list, function (item) {\n      return item.id === instance.id;\n    });\n\n    if (index !== -1) {\n      list.splice(index, 1);\n      this.plugins[instance.type] = list;\n    }\n\n    var state = this.getState();\n    var updatedState = {\n      plugins: _extends({}, state.plugins, (_extends4 = {}, _extends4[instance.id] = undefined, _extends4))\n    };\n    this.setState(updatedState);\n  }\n  /**\n   * Uninstall all plugins and close down this Uppy instance.\n   */\n  ;\n\n  _proto.close = function close() {\n    var _this8 = this;\n\n    this.log(\"Closing Uppy instance \" + this.opts.id + \": removing all files and uninstalling plugins\");\n    this.reset();\n\n    this._storeUnsubscribe();\n\n    this.iteratePlugins(function (plugin) {\n      _this8.removePlugin(plugin);\n    });\n  }\n  /**\n   * Set info message in `state.info`, so that UI plugins like `Informer`\n   * can display the message.\n   *\n   * @param {string | object} message Message to be displayed by the informer\n   * @param {string} [type]\n   * @param {number} [duration]\n   */\n  ;\n\n  _proto.info = function info(message, type, duration) {\n    if (type === void 0) {\n      type = 'info';\n    }\n\n    if (duration === void 0) {\n      duration = 3000;\n    }\n\n    var isComplexMessage = typeof message === 'object';\n    this.setState({\n      info: {\n        isHidden: false,\n        type: type,\n        message: isComplexMessage ? message.message : message,\n        details: isComplexMessage ? message.details : null\n      }\n    });\n    this.emit('info-visible');\n    clearTimeout(this.infoTimeoutID);\n\n    if (duration === 0) {\n      this.infoTimeoutID = undefined;\n      return;\n    } // hide the informer after `duration` milliseconds\n\n\n    this.infoTimeoutID = setTimeout(this.hideInfo, duration);\n  };\n\n  _proto.hideInfo = function hideInfo() {\n    var newInfo = _extends({}, this.getState().info, {\n      isHidden: true\n    });\n\n    this.setState({\n      info: newInfo\n    });\n    this.emit('info-hidden');\n  }\n  /**\n   * Passes messages to a function, provided in `opts.logger`.\n   * If `opts.logger: Uppy.debugLogger` or `opts.debug: true`, logs to the browser console.\n   *\n   * @param {string|object} message to log\n   * @param {string} [type] optional `error` or `warning`\n   */\n  ;\n\n  _proto.log = function log(message, type) {\n    var logger = this.opts.logger;\n\n    switch (type) {\n      case 'error':\n        logger.error(message);\n        break;\n\n      case 'warning':\n        logger.warn(message);\n        break;\n\n      default:\n        logger.debug(message);\n        break;\n    }\n  }\n  /**\n   * Obsolete, event listeners are now added in the constructor.\n   */\n  ;\n\n  _proto.run = function run() {\n    this.log('Calling run() is no longer necessary.', 'warning');\n    return this;\n  }\n  /**\n   * Restore an upload by its ID.\n   */\n  ;\n\n  _proto.restore = function restore(uploadID) {\n    this.log(\"Core: attempting to restore upload \\\"\" + uploadID + \"\\\"\");\n\n    if (!this.getState().currentUploads[uploadID]) {\n      this._removeUpload(uploadID);\n\n      return Promise.reject(new Error('Nonexistent upload'));\n    }\n\n    return this._runUpload(uploadID);\n  }\n  /**\n   * Create an upload for a bunch of files.\n   *\n   * @param {Array<string>} fileIDs File IDs to include in this upload.\n   * @returns {string} ID of this upload.\n   */\n  ;\n\n  _proto._createUpload = function _createUpload(fileIDs, opts) {\n    var _extends5;\n\n    if (opts === void 0) {\n      opts = {};\n    }\n\n    var _opts = opts,\n        _opts$forceAllowNewUp = _opts.forceAllowNewUpload,\n        forceAllowNewUpload = _opts$forceAllowNewUp === void 0 ? false : _opts$forceAllowNewUp;\n\n    var _this$getState6 = this.getState(),\n        allowNewUpload = _this$getState6.allowNewUpload,\n        currentUploads = _this$getState6.currentUploads;\n\n    if (!allowNewUpload && !forceAllowNewUpload) {\n      throw new Error('Cannot create a new upload: already uploading.');\n    }\n\n    var uploadID = cuid();\n    this.emit('upload', {\n      id: uploadID,\n      fileIDs: fileIDs\n    });\n    this.setState({\n      allowNewUpload: this.opts.allowMultipleUploads !== false,\n      currentUploads: _extends({}, currentUploads, (_extends5 = {}, _extends5[uploadID] = {\n        fileIDs: fileIDs,\n        step: 0,\n        result: {}\n      }, _extends5))\n    });\n    return uploadID;\n  };\n\n  _proto._getUpload = function _getUpload(uploadID) {\n    var _this$getState7 = this.getState(),\n        currentUploads = _this$getState7.currentUploads;\n\n    return currentUploads[uploadID];\n  }\n  /**\n   * Add data to an upload's result object.\n   *\n   * @param {string} uploadID The ID of the upload.\n   * @param {object} data Data properties to add to the result object.\n   */\n  ;\n\n  _proto.addResultData = function addResultData(uploadID, data) {\n    var _extends6;\n\n    if (!this._getUpload(uploadID)) {\n      this.log(\"Not setting result for an upload that has been removed: \" + uploadID);\n      return;\n    }\n\n    var currentUploads = this.getState().currentUploads;\n\n    var currentUpload = _extends({}, currentUploads[uploadID], {\n      result: _extends({}, currentUploads[uploadID].result, data)\n    });\n\n    this.setState({\n      currentUploads: _extends({}, currentUploads, (_extends6 = {}, _extends6[uploadID] = currentUpload, _extends6))\n    });\n  }\n  /**\n   * Remove an upload, eg. if it has been canceled or completed.\n   *\n   * @param {string} uploadID The ID of the upload.\n   */\n  ;\n\n  _proto._removeUpload = function _removeUpload(uploadID) {\n    var currentUploads = _extends({}, this.getState().currentUploads);\n\n    delete currentUploads[uploadID];\n    this.setState({\n      currentUploads: currentUploads\n    });\n  }\n  /**\n   * Run an upload. This picks up where it left off in case the upload is being restored.\n   *\n   * @private\n   */\n  ;\n\n  _proto._runUpload = function _runUpload(uploadID) {\n    var _this9 = this;\n\n    var uploadData = this.getState().currentUploads[uploadID];\n    var restoreStep = uploadData.step;\n    var steps = [].concat(this.preProcessors, this.uploaders, this.postProcessors);\n    var lastStep = Promise.resolve();\n    steps.forEach(function (fn, step) {\n      // Skip this step if we are restoring and have already completed this step before.\n      if (step < restoreStep) {\n        return;\n      }\n\n      lastStep = lastStep.then(function () {\n        var _extends7;\n\n        var _this9$getState = _this9.getState(),\n            currentUploads = _this9$getState.currentUploads;\n\n        var currentUpload = currentUploads[uploadID];\n\n        if (!currentUpload) {\n          return;\n        }\n\n        var updatedUpload = _extends({}, currentUpload, {\n          step: step\n        });\n\n        _this9.setState({\n          currentUploads: _extends({}, currentUploads, (_extends7 = {}, _extends7[uploadID] = updatedUpload, _extends7))\n        }); // TODO give this the `updatedUpload` object as its only parameter maybe?\n        // Otherwise when more metadata may be added to the upload this would keep getting more parameters\n\n\n        return fn(updatedUpload.fileIDs, uploadID);\n      }).then(function (result) {\n        return null;\n      });\n    }); // Not returning the `catch`ed promise, because we still want to return a rejected\n    // promise from this method if the upload failed.\n\n    lastStep.catch(function (err) {\n      _this9.emit('error', err, uploadID);\n\n      _this9._removeUpload(uploadID);\n    });\n    return lastStep.then(function () {\n      // Set result data.\n      var _this9$getState2 = _this9.getState(),\n          currentUploads = _this9$getState2.currentUploads;\n\n      var currentUpload = currentUploads[uploadID];\n\n      if (!currentUpload) {\n        return;\n      } // Mark postprocessing step as complete if necessary; this addresses a case where we might get\n      // stuck in the postprocessing UI while the upload is fully complete.\n      // If the postprocessing steps do not do any work, they may not emit postprocessing events at\n      // all, and never mark the postprocessing as complete. This is fine on its own but we\n      // introduced code in the @uppy/core upload-success handler to prepare postprocessing progress\n      // state if any postprocessors are registered. That is to avoid a \"flash of completed state\"\n      // before the postprocessing plugins can emit events.\n      //\n      // So, just in case an upload with postprocessing plugins *has* completed *without* emitting\n      // postprocessing completion, we do it instead.\n\n\n      currentUpload.fileIDs.forEach(function (fileID) {\n        var file = _this9.getFile(fileID);\n\n        if (file && file.progress.postprocess) {\n          _this9.emit('postprocess-complete', file);\n        }\n      });\n      var files = currentUpload.fileIDs.map(function (fileID) {\n        return _this9.getFile(fileID);\n      });\n      var successful = files.filter(function (file) {\n        return !file.error;\n      });\n      var failed = files.filter(function (file) {\n        return file.error;\n      });\n\n      _this9.addResultData(uploadID, {\n        successful: successful,\n        failed: failed,\n        uploadID: uploadID\n      });\n    }).then(function () {\n      // Emit completion events.\n      // This is in a separate function so that the `currentUploads` variable\n      // always refers to the latest state. In the handler right above it refers\n      // to an outdated object without the `.result` property.\n      var _this9$getState3 = _this9.getState(),\n          currentUploads = _this9$getState3.currentUploads;\n\n      if (!currentUploads[uploadID]) {\n        return;\n      }\n\n      var currentUpload = currentUploads[uploadID];\n      var result = currentUpload.result;\n\n      _this9.emit('complete', result);\n\n      _this9._removeUpload(uploadID);\n\n      return result;\n    }).then(function (result) {\n      if (result == null) {\n        _this9.log(\"Not setting result for an upload that has been removed: \" + uploadID);\n      }\n\n      return result;\n    });\n  }\n  /**\n   * Start an upload for all the files that are not currently being uploaded.\n   *\n   * @returns {Promise}\n   */\n  ;\n\n  _proto.upload = function upload() {\n    var _this10 = this;\n\n    if (!this.plugins.uploader) {\n      this.log('No uploader type plugins are used', 'warning');\n    }\n\n    var files = this.getState().files;\n    var onBeforeUploadResult = this.opts.onBeforeUpload(files);\n\n    if (onBeforeUploadResult === false) {\n      return Promise.reject(new Error('Not starting the upload because onBeforeUpload returned false'));\n    }\n\n    if (onBeforeUploadResult && typeof onBeforeUploadResult === 'object') {\n      files = onBeforeUploadResult; // Updating files in state, because uploader plugins receive file IDs,\n      // and then fetch the actual file object from state\n\n      this.setState({\n        files: files\n      });\n    }\n\n    return Promise.resolve().then(function () {\n      return _this10._checkMinNumberOfFiles(files);\n    }).catch(function (err) {\n      _this10._showOrLogErrorAndThrow(err);\n    }).then(function () {\n      var _this10$getState = _this10.getState(),\n          currentUploads = _this10$getState.currentUploads; // get a list of files that are currently assigned to uploads\n\n\n      var currentlyUploadingFiles = Object.keys(currentUploads).reduce(function (prev, curr) {\n        return prev.concat(currentUploads[curr].fileIDs);\n      }, []);\n      var waitingFileIDs = [];\n      Object.keys(files).forEach(function (fileID) {\n        var file = _this10.getFile(fileID); // if the file hasn't started uploading and hasn't already been assigned to an upload..\n\n\n        if (!file.progress.uploadStarted && currentlyUploadingFiles.indexOf(fileID) === -1) {\n          waitingFileIDs.push(file.id);\n        }\n      });\n\n      var uploadID = _this10._createUpload(waitingFileIDs);\n\n      return _this10._runUpload(uploadID);\n    }).catch(function (err) {\n      _this10._showOrLogErrorAndThrow(err, {\n        showInformer: false\n      });\n    });\n  };\n\n  _createClass(Uppy, [{\n    key: \"state\",\n    get: function get() {\n      return this.getState();\n    }\n  }]);\n\n  return Uppy;\n}();\n\nUppy.VERSION = \"1.17.0\";\n\nmodule.exports = function (opts) {\n  return new Uppy(opts);\n}; // Expose class constructor.\n\n\nmodule.exports.Uppy = Uppy;\nmodule.exports.Plugin = Plugin;\nmodule.exports.debugLogger = debugLogger;"]},"metadata":{},"sourceType":"script"}